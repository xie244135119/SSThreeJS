"use strict";var Ft=Object.defineProperty;var jt=(y,e,i)=>e in y?Ft(y,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):y[e]=i;var ae=(y,e,i)=>(jt(y,typeof e!="symbol"?e+"":e,i),i),ht=(y,e,i)=>{if(!e.has(y))throw TypeError("Cannot "+i)};var J=(y,e,i)=>(ht(y,e,"read from private field"),i?i.call(y):e.get(y)),He=(y,e,i)=>{if(e.has(y))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(y):e.set(y,i)},ze=(y,e,i,t)=>(ht(y,e,"write to private field"),t?t.call(y,i):e.set(y,i),i);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("three"),E=require("./three.path.module-5a19eed3.cjs"),Vt=require("lil-gui"),Ht=require("./tool/file.cjs");function Nt(y){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(y){for(const i in y)if(i!=="default"){const t=Object.getOwnPropertyDescriptor(y,i);Object.defineProperty(e,i,t.get?t:{enumerable:!0,get:()=>y[i]})}}return e.default=y,Object.freeze(e)}const A=Nt(r);class Ut{static isWebGLAvailable(){try{const e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch{return!1}}static isWebGL2Available(){try{const e=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&e.getContext("webgl2"))}catch{return!1}}static getWebGLErrorMessage(){return this.getErrorMessage(1)}static getWebGL2ErrorMessage(){return this.getErrorMessage(2)}static getErrorMessage(e){const i={1:"WebGL",2:"WebGL 2"},t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext};let s='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>';const n=document.createElement("div");return n.id="webglmessage",n.style.fontFamily="monospace",n.style.fontSize="13px",n.style.fontWeight="normal",n.style.textAlign="center",n.style.background="#fff",n.style.color="#000",n.style.padding="1.5em",n.style.width="400px",n.style.margin="5em auto 0",t[e]?s=s.replace("$0","graphics card"):s=s.replace("$0","browser"),s=s.replace("$1",i[e]),n.innerHTML=s,n}}const ct=Ut,dt={type:"change"},Je={type:"start"},ut={type:"end"};class rt extends r.EventDispatcher{constructor(e,i){super(),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new r.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:r.MOUSE.ROTATE,MIDDLE:r.MOUSE.DOLLY,RIGHT:r.MOUSE.PAN},this.touches={ONE:r.TOUCH.ROTATE,TWO:r.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(l){l.addEventListener("keydown",Z),this._domElementKeyEvents=l},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Z),this._domElementKeyEvents=null},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(dt),t.update(),n=s.NONE},this.update=function(){const l=new r.Vector3,O=new r.Quaternion().setFromUnitVectors(e.up,new r.Vector3(0,1,0)),$=O.clone().invert(),he=new r.Vector3,ce=new r.Quaternion,ye=2*Math.PI;return function(){const lt=t.object.position;l.copy(lt).sub(t.target),l.applyQuaternion(O),a.setFromVector3(l),t.autoRotate&&n===s.NONE&&D(Y()),t.enableDamping?(a.theta+=h.theta*t.dampingFactor,a.phi+=h.phi*t.dampingFactor):(a.theta+=h.theta,a.phi+=h.phi);let _e=t.minAzimuthAngle,Te=t.maxAzimuthAngle;return isFinite(_e)&&isFinite(Te)&&(_e<-Math.PI?_e+=ye:_e>Math.PI&&(_e-=ye),Te<-Math.PI?Te+=ye:Te>Math.PI&&(Te-=ye),_e<=Te?a.theta=Math.max(_e,Math.min(Te,a.theta)):a.theta=a.theta>(_e+Te)/2?Math.max(_e,a.theta):Math.min(Te,a.theta)),a.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(t.minDistance,Math.min(t.maxDistance,a.radius)),t.enableDamping===!0?t.target.addScaledVector(u,t.dampingFactor):t.target.add(u),l.setFromSpherical(a),l.applyQuaternion($),lt.copy(t.target).add(l),t.object.lookAt(t.target),t.enableDamping===!0?(h.theta*=1-t.dampingFactor,h.phi*=1-t.dampingFactor,u.multiplyScalar(1-t.dampingFactor)):(h.set(0,0,0),u.set(0,0,0)),c=1,f||he.distanceToSquared(t.object.position)>o||8*(1-ce.dot(t.object.quaternion))>o?(t.dispatchEvent(dt),he.copy(t.object.position),ce.copy(t.object.quaternion),f=!1,!0):!1}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",_),t.domElement.removeEventListener("pointerdown",T),t.domElement.removeEventListener("pointercancel",H),t.domElement.removeEventListener("wheel",z),t.domElement.removeEventListener("pointermove",L),t.domElement.removeEventListener("pointerup",H),t._domElementKeyEvents!==null&&(t._domElementKeyEvents.removeEventListener("keydown",Z),t._domElementKeyEvents=null)};const t=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let n=s.NONE;const o=1e-6,a=new r.Spherical,h=new r.Spherical;let c=1;const u=new r.Vector3;let f=!1;const R=new r.Vector2,p=new r.Vector2,v=new r.Vector2,m=new r.Vector2,d=new r.Vector2,x=new r.Vector2,P=new r.Vector2,g=new r.Vector2,w=new r.Vector2,S=[],B={};function Y(){return 2*Math.PI/60/60*t.autoRotateSpeed}function j(){return Math.pow(.95,t.zoomSpeed)}function D(l){h.theta-=l}function G(l){h.phi-=l}const V=function(){const l=new r.Vector3;return function($,he){l.setFromMatrixColumn(he,0),l.multiplyScalar(-$),u.add(l)}}(),oe=function(){const l=new r.Vector3;return function($,he){t.screenSpacePanning===!0?l.setFromMatrixColumn(he,1):(l.setFromMatrixColumn(he,0),l.crossVectors(t.object.up,l)),l.multiplyScalar($),u.add(l)}}(),fe=function(){const l=new r.Vector3;return function($,he){const ce=t.domElement;if(t.object.isPerspectiveCamera){const ye=t.object.position;l.copy(ye).sub(t.target);let Ye=l.length();Ye*=Math.tan(t.object.fov/2*Math.PI/180),V(2*$*Ye/ce.clientHeight,t.object.matrix),oe(2*he*Ye/ce.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(V($*(t.object.right-t.object.left)/t.object.zoom/ce.clientWidth,t.object.matrix),oe(he*(t.object.top-t.object.bottom)/t.object.zoom/ce.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function ie(l){t.object.isPerspectiveCamera?c/=l:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom*l)),t.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function K(l){t.object.isPerspectiveCamera?c*=l:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/l)),t.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function pe(l){R.set(l.clientX,l.clientY)}function W(l){P.set(l.clientX,l.clientY)}function X(l){m.set(l.clientX,l.clientY)}function re(l){p.set(l.clientX,l.clientY),v.subVectors(p,R).multiplyScalar(t.rotateSpeed);const O=t.domElement;D(2*Math.PI*v.x/O.clientHeight),G(2*Math.PI*v.y/O.clientHeight),R.copy(p),t.update()}function se(l){g.set(l.clientX,l.clientY),w.subVectors(g,P),w.y>0?ie(j()):w.y<0&&K(j()),P.copy(g),t.update()}function ve(l){d.set(l.clientX,l.clientY),x.subVectors(d,m).multiplyScalar(t.panSpeed),fe(x.x,x.y),m.copy(d),t.update()}function be(l){l.deltaY<0?K(j()):l.deltaY>0&&ie(j()),t.update()}function De(l){let O=!1;switch(l.code){case t.keys.UP:l.ctrlKey||l.metaKey||l.shiftKey?G(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):fe(0,t.keyPanSpeed),O=!0;break;case t.keys.BOTTOM:l.ctrlKey||l.metaKey||l.shiftKey?G(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):fe(0,-t.keyPanSpeed),O=!0;break;case t.keys.LEFT:l.ctrlKey||l.metaKey||l.shiftKey?D(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):fe(t.keyPanSpeed,0),O=!0;break;case t.keys.RIGHT:l.ctrlKey||l.metaKey||l.shiftKey?D(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):fe(-t.keyPanSpeed,0),O=!0;break}O&&(l.preventDefault(),t.update())}function we(){if(S.length===1)R.set(S[0].pageX,S[0].pageY);else{const l=.5*(S[0].pageX+S[1].pageX),O=.5*(S[0].pageY+S[1].pageY);R.set(l,O)}}function Ie(){if(S.length===1)m.set(S[0].pageX,S[0].pageY);else{const l=.5*(S[0].pageX+S[1].pageX),O=.5*(S[0].pageY+S[1].pageY);m.set(l,O)}}function Me(){const l=S[0].pageX-S[1].pageX,O=S[0].pageY-S[1].pageY,$=Math.sqrt(l*l+O*O);P.set(0,$)}function Le(){t.enableZoom&&Me(),t.enablePan&&Ie()}function b(){t.enableZoom&&Me(),t.enableRotate&&we()}function U(l){if(S.length==1)p.set(l.pageX,l.pageY);else{const $=me(l),he=.5*(l.pageX+$.x),ce=.5*(l.pageY+$.y);p.set(he,ce)}v.subVectors(p,R).multiplyScalar(t.rotateSpeed);const O=t.domElement;D(2*Math.PI*v.x/O.clientHeight),G(2*Math.PI*v.y/O.clientHeight),R.copy(p)}function M(l){if(S.length===1)d.set(l.pageX,l.pageY);else{const O=me(l),$=.5*(l.pageX+O.x),he=.5*(l.pageY+O.y);d.set($,he)}x.subVectors(d,m).multiplyScalar(t.panSpeed),fe(x.x,x.y),m.copy(d)}function C(l){const O=me(l),$=l.pageX-O.x,he=l.pageY-O.y,ce=Math.sqrt($*$+he*he);g.set(0,ce),w.set(0,Math.pow(g.y/P.y,t.zoomSpeed)),ie(w.y),P.copy(g)}function F(l){t.enableZoom&&C(l),t.enablePan&&M(l)}function I(l){t.enableZoom&&C(l),t.enableRotate&&U(l)}function T(l){t.enabled!==!1&&(S.length===0&&(t.domElement.setPointerCapture(l.pointerId),t.domElement.addEventListener("pointermove",L),t.domElement.addEventListener("pointerup",H)),N(l),l.pointerType==="touch"?de(l):ee(l))}function L(l){t.enabled!==!1&&(l.pointerType==="touch"?k(l):le(l))}function H(l){Q(l),S.length===0&&(t.domElement.releasePointerCapture(l.pointerId),t.domElement.removeEventListener("pointermove",L),t.domElement.removeEventListener("pointerup",H)),t.dispatchEvent(ut),n=s.NONE}function ee(l){let O;switch(l.button){case 0:O=t.mouseButtons.LEFT;break;case 1:O=t.mouseButtons.MIDDLE;break;case 2:O=t.mouseButtons.RIGHT;break;default:O=-1}switch(O){case r.MOUSE.DOLLY:if(t.enableZoom===!1)return;W(l),n=s.DOLLY;break;case r.MOUSE.ROTATE:if(l.ctrlKey||l.metaKey||l.shiftKey){if(t.enablePan===!1)return;X(l),n=s.PAN}else{if(t.enableRotate===!1)return;pe(l),n=s.ROTATE}break;case r.MOUSE.PAN:if(l.ctrlKey||l.metaKey||l.shiftKey){if(t.enableRotate===!1)return;pe(l),n=s.ROTATE}else{if(t.enablePan===!1)return;X(l),n=s.PAN}break;default:n=s.NONE}n!==s.NONE&&t.dispatchEvent(Je)}function le(l){switch(n){case s.ROTATE:if(t.enableRotate===!1)return;re(l);break;case s.DOLLY:if(t.enableZoom===!1)return;se(l);break;case s.PAN:if(t.enablePan===!1)return;ve(l);break}}function z(l){t.enabled===!1||t.enableZoom===!1||n!==s.NONE||(l.preventDefault(),t.dispatchEvent(Je),be(l),t.dispatchEvent(ut))}function Z(l){t.enabled===!1||t.enablePan===!1||De(l)}function de(l){switch(q(l),S.length){case 1:switch(t.touches.ONE){case r.TOUCH.ROTATE:if(t.enableRotate===!1)return;we(),n=s.TOUCH_ROTATE;break;case r.TOUCH.PAN:if(t.enablePan===!1)return;Ie(),n=s.TOUCH_PAN;break;default:n=s.NONE}break;case 2:switch(t.touches.TWO){case r.TOUCH.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;Le(),n=s.TOUCH_DOLLY_PAN;break;case r.TOUCH.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;b(),n=s.TOUCH_DOLLY_ROTATE;break;default:n=s.NONE}break;default:n=s.NONE}n!==s.NONE&&t.dispatchEvent(Je)}function k(l){switch(q(l),n){case s.TOUCH_ROTATE:if(t.enableRotate===!1)return;U(l),t.update();break;case s.TOUCH_PAN:if(t.enablePan===!1)return;M(l),t.update();break;case s.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;F(l),t.update();break;case s.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;I(l),t.update();break;default:n=s.NONE}}function _(l){t.enabled!==!1&&l.preventDefault()}function N(l){S.push(l)}function Q(l){delete B[l.pointerId];for(let O=0;O<S.length;O++)if(S[O].pointerId==l.pointerId){S.splice(O,1);return}}function q(l){let O=B[l.pointerId];O===void 0&&(O=new r.Vector2,B[l.pointerId]=O),O.set(l.pageX,l.pageY)}function me(l){const O=l.pointerId===S[0].pointerId?S[1]:S[0];return B[O.pointerId]}t.domElement.addEventListener("contextmenu",_),t.domElement.addEventListener("pointerdown",T),t.domElement.addEventListener("pointercancel",H),t.domElement.addEventListener("wheel",z,{passive:!1}),this.update()}}class Rt extends r.DataTextureLoader{constructor(e){super(e),this.type=r.HalfFloatType}parse(e){const a=function(g,w){switch(g){case 1:console.error("THREE.RGBELoader Read Error: "+(w||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(w||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(w||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(w||""))}return-1},f=`
`,R=function(g,w,S){w=w||1024;let Y=g.pos,j=-1,D=0,G="",V=String.fromCharCode.apply(null,new Uint16Array(g.subarray(Y,Y+128)));for(;0>(j=V.indexOf(f))&&D<w&&Y<g.byteLength;)G+=V,D+=V.length,Y+=128,V+=String.fromCharCode.apply(null,new Uint16Array(g.subarray(Y,Y+128)));return-1<j?(S!==!1&&(g.pos+=D+j+1),G+V.slice(0,j)):!1},p=function(g){const w=/^#\?(\S+)/,S=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,B=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Y=/^\s*FORMAT=(\S+)\s*$/,j=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,D={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let G,V;if(g.pos>=g.byteLength||!(G=R(g)))return a(1,"no header found");if(!(V=G.match(w)))return a(3,"bad initial token");for(D.valid|=1,D.programtype=V[1],D.string+=G+`
`;G=R(g),G!==!1;){if(D.string+=G+`
`,G.charAt(0)==="#"){D.comments+=G+`
`;continue}if((V=G.match(S))&&(D.gamma=parseFloat(V[1])),(V=G.match(B))&&(D.exposure=parseFloat(V[1])),(V=G.match(Y))&&(D.valid|=2,D.format=V[1]),(V=G.match(j))&&(D.valid|=4,D.height=parseInt(V[1],10),D.width=parseInt(V[2],10)),D.valid&2&&D.valid&4)break}return D.valid&2?D.valid&4?D:a(3,"missing image size specifier"):a(3,"missing format specifier")},v=function(g,w,S){const B=w;if(B<8||B>32767||g[0]!==2||g[1]!==2||g[2]&128)return new Uint8Array(g);if(B!==(g[2]<<8|g[3]))return a(3,"wrong scanline width");const Y=new Uint8Array(4*w*S);if(!Y.length)return a(4,"unable to allocate buffer space");let j=0,D=0;const G=4*B,V=new Uint8Array(4),oe=new Uint8Array(G);let fe=S;for(;fe>0&&D<g.byteLength;){if(D+4>g.byteLength)return a(1);if(V[0]=g[D++],V[1]=g[D++],V[2]=g[D++],V[3]=g[D++],V[0]!=2||V[1]!=2||(V[2]<<8|V[3])!=B)return a(3,"bad rgbe scanline format");let ie=0,K;for(;ie<G&&D<g.byteLength;){K=g[D++];const W=K>128;if(W&&(K-=128),K===0||ie+K>G)return a(3,"bad scanline data");if(W){const X=g[D++];for(let re=0;re<K;re++)oe[ie++]=X}else oe.set(g.subarray(D,D+K),ie),ie+=K,D+=K}const pe=B;for(let W=0;W<pe;W++){let X=0;Y[j]=oe[W+X],X+=B,Y[j+1]=oe[W+X],X+=B,Y[j+2]=oe[W+X],X+=B,Y[j+3]=oe[W+X],j+=4}fe--}return Y},m=function(g,w,S,B){const Y=g[w+3],j=Math.pow(2,Y-128)/255;S[B+0]=g[w+0]*j,S[B+1]=g[w+1]*j,S[B+2]=g[w+2]*j,S[B+3]=1},d=function(g,w,S,B){const Y=g[w+3],j=Math.pow(2,Y-128)/255;S[B+0]=r.DataUtils.toHalfFloat(Math.min(g[w+0]*j,65504)),S[B+1]=r.DataUtils.toHalfFloat(Math.min(g[w+1]*j,65504)),S[B+2]=r.DataUtils.toHalfFloat(Math.min(g[w+2]*j,65504)),S[B+3]=r.DataUtils.toHalfFloat(1)},x=new Uint8Array(e);x.pos=0;const P=p(x);if(P!==-1){const g=P.width,w=P.height,S=v(x.subarray(x.pos),g,w);if(S!==-1){let B,Y,j;switch(this.type){case r.FloatType:j=S.length/4;const D=new Float32Array(j*4);for(let V=0;V<j;V++)m(S,V*4,D,V*4);B=D,Y=r.FloatType;break;case r.HalfFloatType:j=S.length/4;const G=new Uint16Array(j*4);for(let V=0;V<j;V++)d(S,V*4,G,V*4);B=G,Y=r.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:g,height:w,data:B,header:P.string,gamma:P.gamma,exposure:P.exposure,type:Y}}}return null}setDataType(e){return this.type=e,this}load(e,i,t,s){function n(o,a){switch(o.type){case r.FloatType:case r.HalfFloatType:o.colorSpace=r.LinearSRGBColorSpace,o.minFilter=r.LinearFilter,o.magFilter=r.LinearFilter,o.generateMipmaps=!1,o.flipY=!0;break}i&&i(o,a)}return super.load(e,n,t,s)}}class Gt extends r.Loader{constructor(e){super(e),this.hdrLoader=new Rt,this.type=r.HalfFloatType}load(e,i,t,s){const n=new r.CubeTexture;switch(n.type=this.type,n.type){case r.FloatType:n.colorSpace=r.LinearSRGBColorSpace,n.minFilter=r.LinearFilter,n.magFilter=r.LinearFilter,n.generateMipmaps=!1;break;case r.HalfFloatType:n.colorSpace=r.LinearSRGBColorSpace,n.minFilter=r.LinearFilter,n.magFilter=r.LinearFilter,n.generateMipmaps=!1;break}const o=this;let a=0;function h(c,u,f,R){new r.FileLoader(o.manager).setPath(o.path).setResponseType("arraybuffer").setWithCredentials(o.withCredentials).load(e[c],function(p){a++;const v=o.hdrLoader.parse(p);if(v){if(v.data!==void 0){const m=new r.DataTexture(v.data,v.width,v.height);m.type=n.type,m.colorSpace=n.colorSpace,m.format=n.format,m.minFilter=n.minFilter,m.magFilter=n.magFilter,m.generateMipmaps=n.generateMipmaps,n.images[c]=m}a===6&&(n.needsUpdate=!0,u&&u(n))}},f,R)}for(let c=0;c<e.length;c++)h(c,i,t,s);return n}setDataType(e){return this.type=e,this.hdrLoader.setDataType(e),this}}class $e extends r.Mesh{constructor(){const e=$e.SkyShader,i=new r.ShaderMaterial({name:"SkyShader",fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:r.UniformsUtils.clone(e.uniforms),side:r.BackSide,depthWrite:!1});super(new r.BoxGeometry(1,1,1),i),this.isSky=!0}}$e.SkyShader={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new r.Vector3},up:{value:new r.Vector3(0,1,0)}},vertexShader:`
		uniform vec3 sunPosition;
		uniform float rayleigh;
		uniform float turbidity;
		uniform float mieCoefficient;
		uniform vec3 up;

		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		// constants for atmospheric scattering
		const float e = 2.71828182845904523536028747135266249775724709369995957;
		const float pi = 3.141592653589793238462643383279502884197169;

		// wavelength of used primaries, according to preetham
		const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
		// this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
		// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
		const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

		// mie stuff
		// K coefficient for the primaries
		const float v = 4.0;
		const vec3 K = vec3( 0.686, 0.678, 0.666 );
		// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
		const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

		// earth shadow hack
		// cutoffAngle = pi / 1.95;
		const float cutoffAngle = 1.6110731556870734;
		const float steepness = 1.5;
		const float EE = 1000.0;

		float sunIntensity( float zenithAngleCos ) {
			zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
			return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
		}

		vec3 totalMie( float T ) {
			float c = ( 0.2 * T ) * 10E-18;
			return 0.434 * c * MieConst;
		}

		void main() {

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vWorldPosition = worldPosition.xyz;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			gl_Position.z = gl_Position.w; // set z to camera.far

			vSunDirection = normalize( sunPosition );

			vSunE = sunIntensity( dot( vSunDirection, up ) );

			vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

			float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

			// extinction (absorbtion + out scattering)
			// rayleigh coefficients
			vBetaR = totalRayleigh * rayleighCoefficient;

			// mie coefficients
			vBetaM = totalMie( turbidity ) * mieCoefficient;

		}`,fragmentShader:`
		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		uniform float mieDirectionalG;
		uniform vec3 up;

		const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

		// constants for atmospheric scattering
		const float pi = 3.141592653589793238462643383279502884197169;

		const float n = 1.0003; // refractive index of air
		const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

		// optical length at zenith for molecules
		const float rayleighZenithLength = 8.4E3;
		const float mieZenithLength = 1.25E3;
		// 66 arc seconds -> degrees, and the cosine of that
		const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

		// 3.0 / ( 16.0 * pi )
		const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
		// 1.0 / ( 4.0 * pi )
		const float ONE_OVER_FOURPI = 0.07957747154594767;

		float rayleighPhase( float cosTheta ) {
			return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
		}

		float hgPhase( float cosTheta, float g ) {
			float g2 = pow( g, 2.0 );
			float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
			return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
		}

		void main() {

			vec3 direction = normalize( vWorldPosition - cameraPos );

			// optical length
			// cutoff angle at 90 to avoid singularity in next formula.
			float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
			float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
			float sR = rayleighZenithLength * inverse;
			float sM = mieZenithLength * inverse;

			// combined extinction factor
			vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

			// in scattering
			float cosTheta = dot( direction, vSunDirection );

			float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
			vec3 betaRTheta = vBetaR * rPhase;

			float mPhase = hgPhase( cosTheta, mieDirectionalG );
			vec3 betaMTheta = vBetaM * mPhase;

			vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
			Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

			// nightsky
			float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
			float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
			vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
			vec3 L0 = vec3( 0.1 ) * Fex;

			// composition + solar disc
			float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
			L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

			vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

			vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

			gl_FragColor = vec4( retColor, 1.0 );

			#include <tonemapping_fragment>
			#include <encodings_fragment>

		}`};class Dt{constructor(e){this.threeContainer=null,this.threeScene=null,this.sceneHelper=null,this.threeCamera=null,this.threeRenderer=null,this.threeOrbitControl=null,this.threeEffectComposer=null,this._resizeObserver=null,this.getModelsByPoint=(i,t=this.threeScene.children,s=[])=>{const n=new A.Vector2(i.offsetX/this.threeContainer.offsetWidth*2-1,-(i.offsetY/this.threeContainer.offsetHeight)*2+1),o=["AmbientLight","PointLight","PointLightHelper","SpotLight","SpotLightHelper","DirectionalLight","DirectionalLightHelper","TransformControls","CameraHelper","AxesHelper","GridHelper","BoxHelper"],h=(t||this.threeScene.children).filter(v=>o.indexOf(v.constructor.name)===-1),c=new A.Raycaster;c.setFromCamera(n,this.threeCamera);let u=c.intersectObjects(h,!0);const f=["Line","Line2","Line3"],R=["可视域视锥体"],p=v=>!(R.indexOf(v.name)!==-1||s.indexOf(v.name)!==-1);return u=u.filter(v=>f.indexOf(v.object.type)===-1&&v.object.visible===!0&&p(v.object)),u},this.changeCameraMode=i=>{var t;if(i!==this.threeCamera.type){if(this.removeCameraHelper(),this.threeCamera&&(this.threeCamera=null,(t=this.threeOrbitControl)==null||t.dispose(),this.threeOrbitControl=null),i==="PerspectiveCamera"){const s=new A.PerspectiveCamera;s.position.set(2,2,2),this.threeCamera=s,this.threeOrbitControl=new rt(this.threeCamera,this.threeContainer)}else if(i==="OrthographicCamera"){const s=new A.OrthographicCamera;s.position.set(0,4,0),this.threeCamera=s,this.threeOrbitControl=new rt(this.threeCamera,this.threeContainer)}this.renderOnce(),this.threeOrbitControl.update(),this.addCameraHelper()}},this.autoWindowResize=()=>{this.threeRenderer.setSize(this.threeContainer.offsetWidth,this.threeContainer.offsetHeight);const i=new window.ResizeObserver(()=>{this.updateCameraMatrix(),this.threeRenderer.setSize(this.threeContainer.offsetWidth,this.threeContainer.offsetHeight)});i.observe(this.threeContainer),this._resizeObserver=i},this.threeContainer=e.container,this.threeScene=e.scene,this.sceneHelper=e.sceneHelper,this.threeOrbitControl=e.control,this.threeCamera=e.camera,this.threeRenderer=e.renderer,this.threeEffectComposer=e.effectComposer}destory(){var e;(e=this._resizeObserver)==null||e.disconnect(),this._resizeObserver=null,this.cancelRenderLoop(),this.removeCameraHelper()}setEye(e,i,t=!0,s=.5,n){if(!t)this.threeCamera.position.copy(e),this.threeOrbitControl.target.copy(i),this.threeOrbitControl.update();else{const o={camera_x:this.threeCamera.position.x,camera_y:this.threeCamera.position.y,camera_z:this.threeCamera.position.z,orbitControl_x:this.threeOrbitControl.target.x,orbitControl_y:this.threeOrbitControl.target.y,orbitControl_z:this.threeOrbitControl.target.z},a={camera_x:e.x,camera_y:e.y,camera_z:e.z,orbitControl_x:i.x,orbitControl_y:i.y,orbitControl_z:i.z};E.SSThreeTool.useTweenAnimate(o,a,h=>{this.threeCamera.position.set(h.camera_x,h.camera_y,h.camera_z),this.threeOrbitControl.target.set(h.orbitControl_x,h.orbitControl_y,h.orbitControl_z),this.threeOrbitControl.update()},s,n)}}getEye(){return{camera:this.threeCamera.position,target:this.threeOrbitControl.target}}updateCameraMatrix(){const e=this.threeContainer.offsetWidth/this.threeContainer.offsetHeight;this.threeCamera instanceof A.PerspectiveCamera?this.threeCamera.aspect=e:this.threeCamera instanceof A.OrthographicCamera&&(this.threeCamera.left=-e*1,this.threeCamera.right=e*1,this.threeCamera.top=1,this.threeCamera.bottom=-1),this.threeCamera.updateProjectionMatrix()}renderLoop(){this.updateCameraMatrix(),E.SSThreeLoop.add(()=>{this.threeRenderer.render(this.threeScene,this.threeCamera)},"webglrender update")}renderOnce(){this.threeRenderer.render(this.threeScene,this.threeCamera),this.sceneHelper&&(this.threeRenderer.autoClear=!1,this.threeRenderer.render(this.sceneHelper,this.threeCamera),this.threeRenderer.autoClear=!0)}cancelRenderLoop(){E.SSThreeLoop.removeId("webglrender update")}addCameraHelper(){const e=new A.CameraHelper(this.threeCamera);e.name="Camera Helper",this.threeScene.add(e)}removeCameraHelper(){const e=this.threeScene.getObjectByName("Camera Helper");e instanceof A.CameraHelper&&(e.dispose(),this.threeScene.remove(e))}}class Wt{constructor(){this._subscribeObjs={},this.subscribe=(e,i)=>{const t=this._subscribeObjs[e]||[],s=Symbol("subcribe");return t.push({type:s,fn:i}),this._subscribeObjs[e]=t,s},this.remove=(e,i)=>{const t=this._subscribeObjs[e]||[],s=t.findIndex(n=>n.type===i);t.splice(s,1)},this.publish=(e="",i={})=>{const t=this._subscribeObjs[e]||[];for(let s=0;s<t.length;s+=1){const{fn:n}=t[s];n==null||n(i)}}}}const ft=new Wt,pt="SSModuleUpdateScribe";class Lt{constructor(e){ae(this,"_debugGui",null);ae(this,"_ssThreeObject",null);ae(this,"_menuContainer",null);ae(this,"_modules",null);ae(this,"_currentEnableModule",null);ae(this,"getModuleByClassName",e=>{var i;return(i=this._modules)==null?void 0:i.find(t=>t.__name===e)});ae(this,"_addModuleGui",e=>{var t,s;const i=(t=e.getModuleConfig)==null?void 0:t.call(e);if(i){i.模块调试=!1;const n=this._debugGui.addFolder(e.title||e.__name);e.__gui=n;const o=(s=e.getModuleConfigSource)==null?void 0:s.call(e);return this._addDebugForObject(i,n,a=>{var h;a.key==="模块调试"&&(a.value?(this._currentEnableModule&&this._currentEnableModule.moduleUpdateGuiValue("模块调试",!1),e.moduleOpenDebug(),this._currentEnableModule=e):(e.moduleCloseDebug(),this._currentEnableModule=null)),i.模块调试&&((h=e.moduleGuiChange)==null||h.call(e,{...a,target:i}))},o),n}return null});ae(this,"_addDrawIcon",()=>{const e=document.createElement("div");e.innerText="调",e.className=E.styles.menuicon,this._ssThreeObject.threeContainer.parentElement.append(e),["relative","absolute"].indexOf(this._ssThreeObject.threeContainer.parentElement.style.position)===-1&&(this._ssThreeObject.threeContainer.parentElement.style.position="relative"),e.onclick=()=>{this._menuContainer.parentElement.style.right="0px",this._menuContainer.parentElement.style.opacity=1}});ae(this,"_addDrawerView",()=>{const e=document.createElement("div");e.className=E.styles.drawer,this._ssThreeObject.threeContainer.parentElement.append(e);const i=document.createElement("div");i.className=E.styles.drawerheader,e.append(i);const t=document.createElement("span");t.className=E.styles.drawerheadertitle,t.innerText="场景调试",i.append(t);const s=document.createElement("div");s.innerText="X",s.className=E.styles.drawerheaderclose,i.append(s),s.onpointerdown=()=>{e.style.right=`-${e.offsetWidth}px`};const n=document.createElement("div");n.className=E.styles.contentview,e.append(n),this._menuContainer=n;const o=document.createElement("div");o.className=E.styles.drawerfooter,e.append(o);const a=document.createElement("div");a.className=E.styles.drawerfooterbtn,a.innerText="导出配置",o.append(a),a.onclick=()=>{this.export()}});this._ssThreeObject=e}destroy(){var e;this.unregisterModules(),this.closeDebugModel(),(e=this._debugGui)==null||e.destroy()}registerModules(e=[]){this._modules=[],e.forEach(i=>{var s;const t=new i;t.ssThreeObject=this._ssThreeObject,t.__name=i.name,(s=t.moduleMount)==null||s.call(t,this._ssThreeObject),this._modules.push(t)}),ft.subscribe(pt,i=>{const t=i.__gui;t==null||t.destroy(),this._debugGui&&this._addModuleGui(i).open()})}unregisterModules(){var e;(e=this._modules)==null||e.forEach(i=>{var t;i.ssThreeObject=null,(t=i.moduleUnmount)==null||t.call(i)}),this._modules=null}export(){const e={};this._modules.forEach(i=>{var s;const t=(s=i.moduleExport)==null?void 0:s.call(i);t&&(e[i.__name]=t)}),Ht.exportJson(e,"ssthreejs.setting.json")}import(e={}){this._modules.forEach(i=>{const t=e[i.__name];if(t){const s=n=>{Object.keys(n).forEach(o=>{const a=n[o];a instanceof Object&&(a.r!==void 0&&a.g!==void 0&&a.b!==void 0&&(n[o]=new A.Color(a.r,a.g,a.b)),s(a))})};s(t),i.moduleImport(t),ft.publish(pt,i)}})}openDebugModel(){this._addDrawIcon(),this._addDrawerView(),this._debugGui===null&&(this._debugGui=new Vt({autoPlace:!0,injectStyles:!0,title:"场景调试",closeFolders:!0,container:this._menuContainer,width:"100%"})),this._modules.forEach(this._addModuleGui)}closeDebugModel(){var e;this._menuContainer&&((e=this._menuContainer.parentElement)==null||e.remove())}_addDebugForObject(e={},i=this._debugGui,t=null,s={}){var o,a;const n=Object.keys(e);for(let h=0;h<n.length;h++){const c=n[h],u=e[c];if(u instanceof A.Color){i.addColor({[c]:u.getRGB({})},c).onChange(p=>{e[c]=p,t==null||t({key:c,value:p,data:e})});continue}if(u instanceof Array&&u.length>0){const p=i.addFolder(c);u.forEach((v,m)=>{if(v instanceof Object){const d=p.addFolder(m+1);this._addDebugForObject(v,d,t,s)}});continue}if(u instanceof Object&&!(u instanceof Function)){const p=i.addFolder(c);this._addDebugForObject(u,p,t,s);continue}const f=s[c];if(f instanceof Array){(o=i.add(e,c,f))==null||o.onChange(p=>{e[c]=p,t==null||t({key:c,value:p,data:e})});continue}const R=s[c]||{};(a=i.add(e,c,R.min,R.max,R.step))==null||a.onChange(p=>{e[c]=p,t==null||t({key:c,value:p,data:e})})}}}class At{constructor(e=0){this._queueList=[],this._runing=!1,this._delayTime=0,this._delayTime=e}add(e=()=>{}){e&&this._queueList.push(e),this._excute()}remove(){setTimeout(()=>{this._runing=!1,this._queueList.splice(0,1),this._excute()},this._delayTime)}_excute(){if(!this._runing&&this._queueList.length>0){const e=this._queueList[0];e&&(this._runing=!0,e())}}destory(){this._queueList=[]}}const Ae=new r.Raycaster,ge=new r.Vector3,Oe=new r.Vector3,ne=new r.Quaternion,mt={X:new r.Vector3(1,0,0),Y:new r.Vector3(0,1,0),Z:new r.Vector3(0,0,1)},et={type:"change"},gt={type:"mouseDown"},yt={type:"mouseUp",mode:null},vt={type:"objectChange"};class Qt extends r.Object3D{constructor(e,i){super(),i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const t=new $t;this._gizmo=t,this.add(t);const s=new Jt;this._plane=s,this.add(s);const n=this;function o(P,g){let w=g;Object.defineProperty(n,P,{get:function(){return w!==void 0?w:g},set:function(S){w!==S&&(w=S,s[P]=S,t[P]=S,n.dispatchEvent({type:P+"-changed",value:S}),n.dispatchEvent(et))}}),n[P]=g,s[P]=g,t[P]=g}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new r.Vector3,h=new r.Vector3,c=new r.Quaternion,u=new r.Quaternion,f=new r.Vector3,R=new r.Quaternion,p=new r.Vector3,v=new r.Vector3,m=new r.Vector3,d=0,x=new r.Vector3;o("worldPosition",a),o("worldPositionStart",h),o("worldQuaternion",c),o("worldQuaternionStart",u),o("cameraPosition",f),o("cameraQuaternion",R),o("pointStart",p),o("pointEnd",v),o("rotationAxis",m),o("rotationAngle",d),o("eye",x),this._offset=new r.Vector3,this._startNorm=new r.Vector3,this._endNorm=new r.Vector3,this._cameraScale=new r.Vector3,this._parentPosition=new r.Vector3,this._parentQuaternion=new r.Quaternion,this._parentQuaternionInv=new r.Quaternion,this._parentScale=new r.Vector3,this._worldScaleStart=new r.Vector3,this._worldQuaternionInv=new r.Quaternion,this._worldScale=new r.Vector3,this._positionStart=new r.Vector3,this._quaternionStart=new r.Quaternion,this._scaleStart=new r.Vector3,this._getPointer=Yt.bind(this),this._onPointerDown=Zt.bind(this),this._onPointerHover=Xt.bind(this),this._onPointerMove=qt.bind(this),this._onPointerUp=Kt.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Ae.setFromCamera(e,this.camera);const i=tt(this._gizmo.picker[this.mode],Ae);i?this.axis=i.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){Ae.setFromCamera(e,this.camera);const i=tt(this._plane,Ae,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,gt.mode=this.mode,this.dispatchEvent(gt)}}pointerMove(e){const i=this.axis,t=this.mode,s=this.object;let n=this.space;if(t==="scale"?n="local":(i==="E"||i==="XYZE"||i==="XYZ")&&(n="world"),s===void 0||i===null||this.dragging===!1||e.button!==-1)return;Ae.setFromCamera(e,this.camera);const o=tt(this._plane,Ae,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),t==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),n==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),n==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(n==="local"&&(s.position.applyQuaternion(ne.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),n==="world"&&(s.parent&&s.position.add(ge.setFromMatrixPosition(s.parent.matrixWorld)),i.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(ge.setFromMatrixPosition(s.parent.matrixWorld))));else if(t==="scale"){if(i.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Oe.set(a,a,a)}else ge.copy(this.pointStart),Oe.copy(this.pointEnd),ge.applyQuaternion(this._worldQuaternionInv),Oe.applyQuaternion(this._worldQuaternionInv),Oe.divide(ge),i.search("X")===-1&&(Oe.x=1),i.search("Y")===-1&&(Oe.y=1),i.search("Z")===-1&&(Oe.z=1);s.scale.copy(this._scaleStart).multiply(Oe),this.scaleSnap&&(i.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(t==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(ge.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(ge.copy(this.rotationAxis).cross(this.eye))*a):(i==="X"||i==="Y"||i==="Z")&&(this.rotationAxis.copy(mt[i]),ge.copy(mt[i]),n==="local"&&ge.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(ge.cross(this.eye).normalize())*a),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),n==="local"&&i!=="E"&&i!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(ne.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(ne.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(et),this.dispatchEvent(vt)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(yt.mode=this.mode,this.dispatchEvent(yt)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(et),this.dispatchEvent(vt),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Ae}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Yt(y){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:y.button};{const e=this.domElement.getBoundingClientRect();return{x:(y.clientX-e.left)/e.width*2-1,y:-(y.clientY-e.top)/e.height*2+1,button:y.button}}}function Xt(y){if(this.enabled)switch(y.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(y));break}}function Zt(y){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(y.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(y)),this.pointerDown(this._getPointer(y)))}function qt(y){this.enabled&&this.pointerMove(this._getPointer(y))}function Kt(y){this.enabled&&(this.domElement.releasePointerCapture(y.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(y)))}function tt(y,e,i){const t=e.intersectObject(y,!0);for(let s=0;s<t.length;s++)if(t[s].object.visible||i)return t[s];return!1}const Xe=new r.Euler,te=new r.Vector3(0,1,0),bt=new r.Vector3(0,0,0),St=new r.Matrix4,Ze=new r.Quaternion,Ke=new r.Quaternion,Se=new r.Vector3,xt=new r.Matrix4,We=new r.Vector3(1,0,0),Be=new r.Vector3(0,1,0),Qe=new r.Vector3(0,0,1),qe=new r.Vector3,Ne=new r.Vector3,Ue=new r.Vector3;class $t extends r.Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new r.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new r.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=e.clone();t.opacity=.15;const s=i.clone();s.opacity=.5;const n=e.clone();n.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const h=e.clone();h.color.setHex(16711680),h.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const u=e.clone();u.color.setHex(255),u.opacity=.5;const f=e.clone();f.opacity=.25;const R=e.clone();R.color.setHex(16776960),R.opacity=.25,e.clone().color.setHex(16776960);const v=e.clone();v.color.setHex(7895160);const m=new r.CylinderGeometry(0,.04,.1,12);m.translate(0,.05,0);const d=new r.BoxGeometry(.08,.08,.08);d.translate(0,.04,0);const x=new r.BufferGeometry;x.setAttribute("position",new r.Float32BufferAttribute([0,0,0,1,0,0],3));const P=new r.CylinderGeometry(.0075,.0075,.5,3);P.translate(0,.25,0);function g(K,pe){const W=new r.TorusGeometry(K,.0075,3,64,pe*Math.PI*2);return W.rotateY(Math.PI/2),W.rotateX(Math.PI/2),W}function w(){const K=new r.BufferGeometry;return K.setAttribute("position",new r.Float32BufferAttribute([0,0,0,1,1,1],3)),K}const S={X:[[new r.Mesh(m,n),[.5,0,0],[0,0,-Math.PI/2]],[new r.Mesh(m,n),[-.5,0,0],[0,0,Math.PI/2]],[new r.Mesh(P,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new r.Mesh(m,o),[0,.5,0]],[new r.Mesh(m,o),[0,-.5,0],[Math.PI,0,0]],[new r.Mesh(P,o)]],Z:[[new r.Mesh(m,a),[0,0,.5],[Math.PI/2,0,0]],[new r.Mesh(m,a),[0,0,-.5],[-Math.PI/2,0,0]],[new r.Mesh(P,a),null,[Math.PI/2,0,0]]],XYZ:[[new r.Mesh(new r.OctahedronGeometry(.1,0),f.clone()),[0,0,0]]],XY:[[new r.Mesh(new r.BoxGeometry(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new r.Mesh(new r.BoxGeometry(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r.Mesh(new r.BoxGeometry(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},B={X:[[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),t),[.3,0,0],[0,0,-Math.PI/2]],[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),t),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),t),[0,.3,0]],[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),t),[0,-.3,0],[0,0,Math.PI]]],Z:[[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),t),[0,0,.3],[Math.PI/2,0,0]],[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),t),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new r.Mesh(new r.OctahedronGeometry(.2,0),t)]],XY:[[new r.Mesh(new r.BoxGeometry(.2,.2,.01),t),[.15,.15,0]]],YZ:[[new r.Mesh(new r.BoxGeometry(.2,.2,.01),t),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r.Mesh(new r.BoxGeometry(.2,.2,.01),t),[.15,0,.15],[-Math.PI/2,0,0]]]},Y={START:[[new r.Mesh(new r.OctahedronGeometry(.01,2),s),null,null,null,"helper"]],END:[[new r.Mesh(new r.OctahedronGeometry(.01,2),s),null,null,null,"helper"]],DELTA:[[new r.Line(w(),s),null,null,null,"helper"]],X:[[new r.Line(x,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new r.Line(x,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new r.Line(x,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},j={XYZE:[[new r.Mesh(g(.5,1),v),null,[0,Math.PI/2,0]]],X:[[new r.Mesh(g(.5,.5),n)]],Y:[[new r.Mesh(g(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new r.Mesh(g(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new r.Mesh(g(.75,1),R),null,[0,Math.PI/2,0]]]},D={AXIS:[[new r.Line(x,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},G={XYZE:[[new r.Mesh(new r.SphereGeometry(.25,10,8),t)]],X:[[new r.Mesh(new r.TorusGeometry(.5,.1,4,24),t),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new r.Mesh(new r.TorusGeometry(.5,.1,4,24),t),[0,0,0],[Math.PI/2,0,0]]],Z:[[new r.Mesh(new r.TorusGeometry(.5,.1,4,24),t),[0,0,0],[0,0,-Math.PI/2]]],E:[[new r.Mesh(new r.TorusGeometry(.75,.1,2,24),t)]]},V={X:[[new r.Mesh(d,n),[.5,0,0],[0,0,-Math.PI/2]],[new r.Mesh(P,n),[0,0,0],[0,0,-Math.PI/2]],[new r.Mesh(d,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new r.Mesh(d,o),[0,.5,0]],[new r.Mesh(P,o)],[new r.Mesh(d,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new r.Mesh(d,a),[0,0,.5],[Math.PI/2,0,0]],[new r.Mesh(P,a),[0,0,0],[Math.PI/2,0,0]],[new r.Mesh(d,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new r.Mesh(new r.BoxGeometry(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new r.Mesh(new r.BoxGeometry(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r.Mesh(new r.BoxGeometry(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new r.Mesh(new r.BoxGeometry(.1,.1,.1),f.clone())]]},oe={X:[[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),t),[.3,0,0],[0,0,-Math.PI/2]],[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),t),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),t),[0,.3,0]],[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),t),[0,-.3,0],[0,0,Math.PI]]],Z:[[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),t),[0,0,.3],[Math.PI/2,0,0]],[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),t),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new r.Mesh(new r.BoxGeometry(.2,.2,.01),t),[.15,.15,0]]],YZ:[[new r.Mesh(new r.BoxGeometry(.2,.2,.01),t),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r.Mesh(new r.BoxGeometry(.2,.2,.01),t),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new r.Mesh(new r.BoxGeometry(.2,.2,.2),t),[0,0,0]]]},fe={X:[[new r.Line(x,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new r.Line(x,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new r.Line(x,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function ie(K){const pe=new r.Object3D;for(const W in K)for(let X=K[W].length;X--;){const re=K[W][X][0].clone(),se=K[W][X][1],ve=K[W][X][2],be=K[W][X][3],De=K[W][X][4];re.name=W,re.tag=De,se&&re.position.set(se[0],se[1],se[2]),ve&&re.rotation.set(ve[0],ve[1],ve[2]),be&&re.scale.set(be[0],be[1],be[2]),re.updateMatrix();const we=re.geometry.clone();we.applyMatrix4(re.matrix),re.geometry=we,re.renderOrder=1/0,re.position.set(0,0,0),re.rotation.set(0,0,0),re.scale.set(1,1,1),pe.add(re)}return pe}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=ie(S)),this.add(this.gizmo.rotate=ie(j)),this.add(this.gizmo.scale=ie(V)),this.add(this.picker.translate=ie(B)),this.add(this.picker.rotate=ie(G)),this.add(this.picker.scale=ie(oe)),this.add(this.helper.translate=ie(Y)),this.add(this.helper.rotate=ie(D)),this.add(this.helper.scale=ie(fe)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Ke;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let n=0;n<s.length;n++){const o=s[n];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(ne.setFromEuler(Xe.set(0,0,0)),o.quaternion.copy(t).multiply(ne),Math.abs(te.copy(We).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(ne.setFromEuler(Xe.set(0,0,Math.PI/2)),o.quaternion.copy(t).multiply(ne),Math.abs(te.copy(Be).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(ne.setFromEuler(Xe.set(0,Math.PI/2,0)),o.quaternion.copy(t).multiply(ne),Math.abs(te.copy(Qe).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(ne.setFromEuler(Xe.set(0,Math.PI/2,0)),te.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(St.lookAt(bt,te,Be)),o.quaternion.multiply(ne),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),ge.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),ge.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(ge),o.visible=this.dragging):(o.quaternion.copy(t),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(te.copy(We).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(te.copy(Be).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(te.copy(Qe).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(te.copy(Qe).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(te.copy(We).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(te.copy(Be).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(Ze.copy(t),te.copy(this.eye).applyQuaternion(ne.copy(t).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(St.lookAt(this.eye,bt,Be)),o.name==="X"&&(ne.setFromAxisAngle(We,Math.atan2(-te.y,te.z)),ne.multiplyQuaternions(Ze,ne),o.quaternion.copy(ne)),o.name==="Y"&&(ne.setFromAxisAngle(Be,Math.atan2(te.x,te.z)),ne.multiplyQuaternions(Ze,ne),o.quaternion.copy(ne)),o.name==="Z"&&(ne.setFromAxisAngle(Qe,Math.atan2(te.y,te.x)),ne.multiplyQuaternions(Ze,ne),o.quaternion.copy(ne))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(h){return o.name===h}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class Jt extends r.Mesh{constructor(){super(new r.PlaneGeometry(1e5,1e5,2,2),new r.MeshBasicMaterial({visible:!1,wireframe:!0,side:r.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),qe.copy(We).applyQuaternion(i==="local"?this.worldQuaternion:Ke),Ne.copy(Be).applyQuaternion(i==="local"?this.worldQuaternion:Ke),Ue.copy(Qe).applyQuaternion(i==="local"?this.worldQuaternion:Ke),te.copy(Ne),this.mode){case"translate":case"scale":switch(this.axis){case"X":te.copy(this.eye).cross(qe),Se.copy(qe).cross(te);break;case"Y":te.copy(this.eye).cross(Ne),Se.copy(Ne).cross(te);break;case"Z":te.copy(this.eye).cross(Ue),Se.copy(Ue).cross(te);break;case"XY":Se.copy(Ue);break;case"YZ":Se.copy(qe);break;case"XZ":te.copy(Ue),Se.copy(Ne);break;case"XYZ":case"E":Se.set(0,0,0);break}break;case"rotate":default:Se.set(0,0,0)}Se.length()===0?this.quaternion.copy(this.cameraQuaternion):(xt.lookAt(ge.set(0,0,0),Se,te),this.quaternion.setFromRotationMatrix(xt)),super.updateMatrixWorld(e)}}class ei{constructor(e,i){this.onControlChange=null,this._ssThreeObject=null,this._control=null,this._event=null,this._boxHeloper=null,this.focus=t=>{const s=this._ssThreeObject.threeCamera;let n;const o=new A.Box3,a=new A.Vector3,h=new A.Sphere,c=new A.Vector3;o.setFromObject(t),o.isEmpty()===!1?(o.getCenter(a),n=o.getBoundingSphere(h).radius):(a.setFromMatrixPosition(t.matrixWorld),n=.1),c.set(0,0,1),c.applyQuaternion(s.quaternion),c.multiplyScalar(n*2),s.position.copy(a).add(c),this._ssThreeObject.threeOrbitControl.target.copy(a),this._ssThreeObject.threeOrbitControl.update()},this._ssThreeObject=e,this.onControlChange=i}destory(){var e,i,t;(e=this._event)==null||e.destory(),this._event=null,this._ssThreeObject=null,(i=this._control)==null||i.removeFromParent(),(t=this._control)==null||t.dispose(),this.onControlChange=null,this._control=null}attach(e){this._control||(this._control=new Qt(this._ssThreeObject.threeCamera,this._ssThreeObject.threeContainer),(this._ssThreeObject.sceneHelper||this._ssThreeObject.threeScene).add(this._control),this._control.addEventListener("change",i=>{var t,s;this._ssThreeObject.threeOrbitControl.enableRotate=!this._control.dragging,this._control.object&&((t=this._boxHeloper)==null||t.setFromObject(this._control.object),(s=this.onControlChange)==null||s.call(this,{name:this._control.object.name,uuid:this._control.object.uuid,target:this._control.object,type:"change",position:new A.Vector3(this._control.object.position.x,this._control.object.position.y,this._control.object.position.z),rotation:new A.Vector3(A.MathUtils.radToDeg(this._control.object.rotation.x),A.MathUtils.radToDeg(this._control.object.rotation.y),A.MathUtils.radToDeg(this._control.object.rotation.z)),scale:this._control.object.scale}))}),this._control.addEventListener("objectChange",i=>{}),this._event=new E.SSEvent(this._ssThreeObject.threeContainer),this._event.addEventListener(E.SSEvent.SSEventType.KEYDOWN,i=>{var t,s;if(this._control.object)switch(i.key){case"q":this._control.setSpace(this._control.space==="world"?"local":"world");break;case"e":this._control.setMode("rotate");break;case"w":this._control.setMode("translate");break;case"r":this._control.setMode("scale");break;case"x":this._control.showX=!this._control.showX;break;case"y":this._control.showY=!this._control.showY;break;case"z":this._control.showZ=!this._control.showZ;break;case"Escape":this.detach();break;case"_":case"-":this._control.setSize(this._control.size*.9);break;case"f":if(!this._control.object)return;this.focus(this._control.object),(t=this.onControlChange)==null||t.call(this,{name:this._control.object.name,uuid:this._control.object.uuid,target:this._control.object,type:"focus"});break;case"=":case"+":this._control.setSize(this._control.size*1.1);break;case"Backspace":if(!this._control.object)return;this._boxHeloper.removeFromParent(),this._boxHeloper=null;const{name:n,uuid:o,id:a}=this._control.object;this._control.detach(),(s=this.onControlChange)==null||s.call(this,{name:n,uuid:o,targetId:a,type:"delete"});break}})),this._control.attach(e),this._boxHeloper||(this._boxHeloper=new A.BoxHelper(e),this._boxHeloper.name="boxhelper",(this._ssThreeObject.sceneHelper||this._ssThreeObject.threeScene).add(this._boxHeloper)),this._boxHeloper.setFromObject(e)}detach(){var e;this._control.detach(),(e=this._boxHeloper)==null||e.removeFromParent(),this._boxHeloper=null}set enabled(e){this._control&&(e||this.detach(),this._control.enabled=e)}}const ot={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class Ve{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const ti=new r.OrthographicCamera(-1,1,1,-1,0,1),nt=new r.BufferGeometry;nt.setAttribute("position",new r.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3));nt.setAttribute("uv",new r.Float32BufferAttribute([0,2,0,0,2,0],2));class at{constructor(e){this._mesh=new r.Mesh(nt,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,ti)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class st extends Ve{constructor(e,i){super(),this.textureID=i!==void 0?i:"tDiffuse",e instanceof r.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=r.UniformsUtils.clone(e.uniforms),this.material=new r.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new at(this.material)}render(e,i,t){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=t.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class wt extends Ve{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,t){const s=e.getContext(),n=e.state;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),n.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),n.buffers.stencil.setClear(a),n.buffers.stencil.setLocked(!0),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(s.EQUAL,1,4294967295),n.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),n.buffers.stencil.setLocked(!0)}}class ii extends Ve{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Mt{constructor(e,i){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),i===void 0){const t=e.getSize(new r.Vector2);this._width=t.width,this._height=t.height,i=new r.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio),i.texture.name="EffectComposer.rt1"}else this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new st(ot),this.clock=new r.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const i=this.passes.indexOf(e);i!==-1&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const i=this.renderer.getRenderTarget();let t=!1;for(let s=0,n=this.passes.length;s<n;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,t),o.needsSwap){if(t){const a=this.renderer.getContext(),h=this.renderer.state.buffers.stencil;h.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),h.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}wt!==void 0&&(o instanceof wt?t=!0:o instanceof ii&&(t=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(e===void 0){const i=this.renderer.getSize(new r.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;const t=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(t,s),this.renderTarget2.setSize(t,s);for(let n=0;n<this.passes.length;n++)this.passes[n].setSize(t,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class ri extends Ve{constructor(e,i,t,s,n){super(),this.scene=e,this.camera=i,this.overrideMaterial=t,this.clearColor=s,this.clearAlpha=n!==void 0?n:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new r.Color}render(e,i,t){const s=e.autoClear;e.autoClear=!1;let n,o;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),n=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,n),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=s}}const si={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new r.Color(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			vec3 luma = vec3( 0.299, 0.587, 0.114 );

			float v = dot( texel.xyz, luma );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class je extends Ve{constructor(e,i,t,s){super(),this.strength=i!==void 0?i:1,this.radius=t,this.threshold=s,this.resolution=e!==void 0?new r.Vector2(e.x,e.y):new r.Vector2(256,256),this.clearColor=new r.Color(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let n=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new r.WebGLRenderTarget(n,o),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let f=0;f<this.nMips;f++){const R=new r.WebGLRenderTarget(n,o);R.texture.name="UnrealBloomPass.h"+f,R.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(R);const p=new r.WebGLRenderTarget(n,o);p.texture.name="UnrealBloomPass.v"+f,p.texture.generateMipmaps=!1,this.renderTargetsVertical.push(p),n=Math.round(n/2),o=Math.round(o/2)}const a=si;this.highPassUniforms=r.UniformsUtils.clone(a.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new r.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const h=[3,5,7,9,11];n=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);for(let f=0;f<this.nMips;f++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(h[f])),this.separableBlurMaterials[f].uniforms.texSize.value=new r.Vector2(n,o),n=Math.round(n/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=i,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const c=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=c,this.bloomTintColors=[new r.Vector3(1,1,1),new r.Vector3(1,1,1),new r.Vector3(1,1,1),new r.Vector3(1,1,1),new r.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const u=ot;this.copyUniforms=r.UniformsUtils.clone(u.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new r.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:r.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new r.Color,this.oldClearAlpha=1,this.basic=new r.MeshBasicMaterial,this.fsQuad=new at(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.materialCopy.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,i){let t=Math.round(e/2),s=Math.round(i/2);this.renderTargetBright.setSize(t,s);for(let n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(t,s),this.renderTargetsVertical[n].setSize(t,s),this.separableBlurMaterials[n].uniforms.texSize.value=new r.Vector2(t,s),t=Math.round(t/2),s=Math.round(s/2)}render(e,i,t,s,n){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),n&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=t.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=t.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let a=this.renderTargetBright;for(let h=0;h<this.nMips;h++)this.fsQuad.material=this.separableBlurMaterials[h],this.separableBlurMaterials[h].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[h].uniforms.direction.value=je.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[h]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[h].uniforms.colorTexture.value=this.renderTargetsHorizontal[h].texture,this.separableBlurMaterials[h].uniforms.direction.value=je.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[h]),e.clear(),this.fsQuad.render(e),a=this.renderTargetsVertical[h];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o}getSeperableBlurMaterial(e){return new r.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new r.Vector2(.5,.5)},direction:{value:new r.Vector2(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new r.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}je.BlurDirectionX=new r.Vector2(1,0);je.BlurDirectionY=new r.Vector2(0,1);class Re extends Ve{constructor(e,i,t,s){super(),this.renderScene=i,this.renderCamera=t,this.selectedObjects=s!==void 0?s:[],this.visibleEdgeColor=new r.Color(1,1,1),this.hiddenEdgeColor=new r.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=e!==void 0?new r.Vector2(e.x,e.y):new r.Vector2(256,256);const n=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new r.WebGLRenderTarget(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new r.MeshDepthMaterial,this.depthMaterial.side=r.DoubleSide,this.depthMaterial.depthPacking=r.RGBADepthPacking,this.depthMaterial.blending=r.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=r.DoubleSide,this.prepareMaskMaterial.fragmentShader=u(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new r.WebGLRenderTarget(this.resolution.x,this.resolution.y),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new r.WebGLRenderTarget(n,o),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new r.WebGLRenderTarget(n,o),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new r.WebGLRenderTarget(Math.round(n/2),Math.round(o/2)),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new r.WebGLRenderTarget(n,o),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new r.WebGLRenderTarget(Math.round(n/2),Math.round(o/2)),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;const a=4,h=4;this.separableBlurMaterial1=this.getSeperableBlurMaterial(a),this.separableBlurMaterial1.uniforms.texSize.value.set(n,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(h),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(n/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=h,this.overlayMaterial=this.getOverlayMaterial();const c=ot;this.copyUniforms=r.UniformsUtils.clone(c.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new r.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:r.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new r.Color,this.oldClearAlpha=1,this.fsQuad=new at(null),this.tempPulseColor1=new r.Color,this.tempPulseColor2=new r.Color,this.textureMatrix=new r.Matrix4;function u(f,R){const p=R.isPerspectiveCamera?"perspective":"orthographic";return f.replace(/DEPTH_TO_VIEW_Z/g,p+"DepthToViewZ")}}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(e,i){this.renderTargetMaskBuffer.setSize(e,i),this.renderTargetDepthBuffer.setSize(e,i);let t=Math.round(e/this.downSampleRatio),s=Math.round(i/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(t,s),this.renderTargetBlurBuffer1.setSize(t,s),this.renderTargetEdgeBuffer1.setSize(t,s),this.separableBlurMaterial1.uniforms.texSize.value.set(t,s),t=Math.round(t/2),s=Math.round(s/2),this.renderTargetBlurBuffer2.setSize(t,s),this.renderTargetEdgeBuffer2.setSize(t,s),this.separableBlurMaterial2.uniforms.texSize.value.set(t,s)}changeVisibilityOfSelectedObjects(e){const i=this._visibilityCache;function t(s){s.isMesh&&(e===!0?s.visible=i.get(s):(i.set(s,s.visible),s.visible=e))}for(let s=0;s<this.selectedObjects.length;s++)this.selectedObjects[s].traverse(t)}changeVisibilityOfNonSelectedObjects(e){const i=this._visibilityCache,t=[];function s(o){o.isMesh&&t.push(o)}for(let o=0;o<this.selectedObjects.length;o++)this.selectedObjects[o].traverse(s);function n(o){if(o.isMesh||o.isSprite){let a=!1;for(let h=0;h<t.length;h++)if(t[h].id===o.id){a=!0;break}if(a===!1){const h=o.visible;(e===!1||i.get(o)===!0)&&(o.visible=e),i.set(o,h)}}else(o.isPoints||o.isLine)&&(e===!0?o.visible=i.get(o):(i.set(o,o.visible),o.visible=e))}this.renderScene.traverse(n)}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,i,t,s,n){if(this.selectedObjects.length>0){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,n&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const a=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=a,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const h=.625+Math.cos(performance.now()*.01/this.pulsePeriod)*.75/2;this.tempPulseColor1.multiplyScalar(h),this.tempPulseColor2.multiplyScalar(h)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Re.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Re.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Re.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Re.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,n&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(t),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=t.texture,e.setRenderTarget(null),this.fsQuad.render(e))}getPrepareMaskMaterial(){return new r.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new r.Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:`#include <morphtarget_pars_vertex>
				#include <skinning_pars_vertex>

				varying vec4 projTexCoord;
				varying vec4 vPosition;
				uniform mat4 textureMatrix;

				void main() {

					#include <skinbase_vertex>
					#include <begin_vertex>
					#include <morphtarget_vertex>
					#include <skinning_vertex>
					#include <project_vertex>

					vPosition = mvPosition;

					vec4 worldPosition = vec4( transformed, 1.0 );

					#ifdef USE_INSTANCING

						worldPosition = instanceMatrix * worldPosition;

					#endif
					
					worldPosition = modelMatrix * worldPosition;

					projTexCoord = textureMatrix * worldPosition;

				}`,fragmentShader:`#include <packing>
				varying vec4 vPosition;
				varying vec4 projTexCoord;
				uniform sampler2D depthTexture;
				uniform vec2 cameraNearFar;

				void main() {

					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));
					float viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);

				}`})}getEdgeDetectionMaterial(){return new r.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new r.Vector2(.5,.5)},visibleEdgeColor:{value:new r.Vector3(1,1,1)},hiddenEdgeColor:{value:new r.Vector3(1,1,1)}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform vec2 texSize;
				uniform vec3 visibleEdgeColor;
				uniform vec3 hiddenEdgeColor;

				void main() {
					vec2 invSize = 1.0 / texSize;
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);
					float diff1 = (c1.r - c2.r)*0.5;
					float diff2 = (c3.r - c4.r)*0.5;
					float d = length( vec2(diff1, diff2) );
					float a1 = min(c1.g, c2.g);
					float a2 = min(c3.g, c4.g);
					float visibilityFactor = min(a1, a2);
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);
				}`})}getSeperableBlurMaterial(e){return new r.ShaderMaterial({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new r.Vector2(.5,.5)},direction:{value:new r.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;
				uniform float kernelRadius;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}

				void main() {
					vec2 invSize = 1.0 / texSize;
					float sigma = kernelRadius/2.0;
					float weightSum = gaussianPdf(0.0, sigma);
					vec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
					vec2 uvOffset = delta;
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {
						float x = kernelRadius * float(i) / float(MAX_RADIUS);
						float w = gaussianPdf(x, sigma);
						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						diffuseSum += ((sample1 + sample2) * w);
						weightSum += (2.0 * w);
						uvOffset += delta;
					}
					gl_FragColor = diffuseSum/weightSum;
				}`})}getOverlayMaterial(){return new r.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform sampler2D edgeTexture1;
				uniform sampler2D edgeTexture2;
				uniform sampler2D patternTexture;
				uniform float edgeStrength;
				uniform float edgeGlow;
				uniform bool usePatternTexture;

				void main() {
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
					vec4 maskColor = texture2D(maskTexture, vUv);
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
					if(usePatternTexture)
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
					gl_FragColor = finalColor;
				}`,blending:r.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}Re.BlurDirectionX=new r.Vector2(1,0);Re.BlurDirectionY=new r.Vector2(0,1);const oi={uniforms:{tDiffuse:{value:null},resolution:{value:new r.Vector2(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
	precision highp float;

	uniform sampler2D tDiffuse;

	uniform vec2 resolution;

	varying vec2 vUv;

	// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)

	//----------------------------------------------------------------------------------
	// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag
	// SDK Version: v3.00
	// Email:       gameworks@nvidia.com
	// Site:        http://developer.nvidia.com/
	//
	// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.
	//
	// Redistribution and use in source and binary forms, with or without
	// modification, are permitted provided that the following conditions
	// are met:
	//  * Redistributions of source code must retain the above copyright
	//    notice, this list of conditions and the following disclaimer.
	//  * Redistributions in binary form must reproduce the above copyright
	//    notice, this list of conditions and the following disclaimer in the
	//    documentation and/or other materials provided with the distribution.
	//  * Neither the name of NVIDIA CORPORATION nor the names of its
	//    contributors may be used to endorse or promote products derived
	//    from this software without specific prior written permission.
	//
	// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY
	// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
	// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
	// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
	// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
	// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
	// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	//
	//----------------------------------------------------------------------------------

	#ifndef FXAA_DISCARD
			//
			// Only valid for PC OpenGL currently.
			// Probably will not work when FXAA_GREEN_AS_LUMA = 1.
			//
			// 1 = Use discard on pixels which don't need AA.
			//     For APIs which enable concurrent TEX+ROP from same surface.
			// 0 = Return unchanged color on pixels which don't need AA.
			//
			#define FXAA_DISCARD 0
	#endif

	/*--------------------------------------------------------------------------*/
	#define FxaaTexTop(t, p) texture2D(t, p, -100.0)
	#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)
	/*--------------------------------------------------------------------------*/

	#define NUM_SAMPLES 5

	// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha
	float contrast( vec4 a, vec4 b ) {
			vec4 diff = abs( a - b );
			return max( max( max( diff.r, diff.g ), diff.b ), diff.a );
	}

	/*============================================================================

									FXAA3 QUALITY - PC

	============================================================================*/

	/*--------------------------------------------------------------------------*/
	vec4 FxaaPixelShader(
			vec2 posM,
			sampler2D tex,
			vec2 fxaaQualityRcpFrame,
			float fxaaQualityEdgeThreshold,
			float fxaaQualityinvEdgeThreshold
	) {
			vec4 rgbaM = FxaaTexTop(tex, posM);
			vec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);
			// . S .
			// W M E
			// . N .

			bool earlyExit = max( max( max(
					contrast( rgbaM, rgbaN ),
					contrast( rgbaM, rgbaS ) ),
					contrast( rgbaM, rgbaE ) ),
					contrast( rgbaM, rgbaW ) )
					< fxaaQualityEdgeThreshold;
			// . 0 .
			// 0 0 0
			// . 0 .

			#if (FXAA_DISCARD == 1)
					if(earlyExit) FxaaDiscard;
			#else
					if(earlyExit) return rgbaM;
			#endif

			float contrastN = contrast( rgbaM, rgbaN );
			float contrastS = contrast( rgbaM, rgbaS );
			float contrastE = contrast( rgbaM, rgbaE );
			float contrastW = contrast( rgbaM, rgbaW );

			float relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );
			relativeVContrast *= fxaaQualityinvEdgeThreshold;

			bool horzSpan = relativeVContrast > 0.;
			// . 1 .
			// 0 0 0
			// . 1 .

			// 45 deg edge detection and corners of objects, aka V/H contrast is too similar
			if( abs( relativeVContrast ) < .3 ) {
					// locate the edge
					vec2 dirToEdge;
					dirToEdge.x = contrastE > contrastW ? 1. : -1.;
					dirToEdge.y = contrastS > contrastN ? 1. : -1.;
					// . 2 .      . 1 .
					// 1 0 2  ~=  0 0 1
					// . 1 .      . 0 .

					// tap 2 pixels and see which ones are "outside" the edge, to
					// determine if the edge is vertical or horizontal

					vec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);
					float matchAlongH = contrast( rgbaM, rgbaAlongH );
					// . 1 .
					// 0 0 1
					// . 0 H

					vec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);
					float matchAlongV = contrast( rgbaM, rgbaAlongV );
					// V 1 .
					// 0 0 1
					// . 0 .

					relativeVContrast = matchAlongV - matchAlongH;
					relativeVContrast *= fxaaQualityinvEdgeThreshold;

					if( abs( relativeVContrast ) < .3 ) { // 45 deg edge
							// 1 1 .
							// 0 0 1
							// . 0 1

							// do a simple blur
							return mix(
									rgbaM,
									(rgbaN + rgbaS + rgbaE + rgbaW) * .25,
									.4
							);
					}

					horzSpan = relativeVContrast > 0.;
			}

			if(!horzSpan) rgbaN = rgbaW;
			if(!horzSpan) rgbaS = rgbaE;
			// . 0 .      1
			// 1 0 1  ->  0
			// . 0 .      1

			bool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );
			if(!pairN) rgbaN = rgbaS;

			vec2 offNP;
			offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;
			offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;

			bool doneN = false;
			bool doneP = false;

			float nDist = 0.;
			float pDist = 0.;

			vec2 posN = posM;
			vec2 posP = posM;

			int iterationsUsed = 0;
			int iterationsUsedN = 0;
			int iterationsUsedP = 0;
			for( int i = 0; i < NUM_SAMPLES; i++ ) {
					iterationsUsed = i;

					float increment = float(i + 1);

					if(!doneN) {
							nDist += increment;
							posN = posM + offNP * nDist;
							vec4 rgbaEndN = FxaaTexTop(tex, posN.xy);
							doneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );
							iterationsUsedN = i;
					}

					if(!doneP) {
							pDist += increment;
							posP = posM - offNP * pDist;
							vec4 rgbaEndP = FxaaTexTop(tex, posP.xy);
							doneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );
							iterationsUsedP = i;
					}

					if(doneN || doneP) break;
			}


			if ( !doneP && !doneN ) return rgbaM; // failed to find end of edge

			float dist = min(
					doneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,
					doneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.
			);

			// hacky way of reduces blurriness of mostly diagonal edges
			// but reduces AA quality
			dist = pow(dist, .5);

			dist = 1. - dist;

			return mix(
					rgbaM,
					rgbaN,
					dist * .5
			);
	}

	void main() {
			const float edgeDetectionQuality = .2;
			const float invEdgeDetectionQuality = 1. / edgeDetectionQuality;

			gl_FragColor = FxaaPixelShader(
					vUv,
					tDiffuse,
					resolution,
					edgeDetectionQuality, // [0,1] contrast needed, otherwise early discard
					invEdgeDetectionQuality
			);

	}
	`},ni={uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 tex = texture2D( tDiffuse, vUv );

			gl_FragColor = LinearTosRGB( tex );

		}`};var ue,Ee,Ce,Pe;class ai{constructor(e){ae(this,"title","模块-three后处理【原生版】");ae(this,"effectComposer",null);He(this,ue,null);He(this,Ee,null);He(this,Ce,null);He(this,Pe,null);ae(this,"destroy",()=>{if(this.closeRender(),this.effectComposer){let e=this.getEffectComposer();e.passes.forEach(i=>{E.SSDispose.dispose(i)}),E.SSDispose.dispose(e.copyPass),ze(this,ue,null),e.passes=[],e.renderTarget1.dispose(),e.renderTarget2.dispose(),e.writeBuffer=null,e.readBuffer=null,e.copyPass=null,e=null}});ae(this,"setup",()=>{const e=new st(oi),i=this.ssThreeObject.threeRenderer.getPixelRatio();e.material.uniforms.resolution.value.x=1/(this.ssThreeObject.threeContainer.offsetWidth*i),e.material.uniforms.resolution.value.y=1/(this.ssThreeObject.threeContainer.offsetHeight*i),this.getEffectComposer().addPass(e)});ae(this,"addOutlineByObject3Ds",(e=[],i="#003354")=>{const t=this.getEffectComposer(),{threeContainer:s,threeScene:n,threeCamera:o}=this.ssThreeObject;J(this,Ee)===null&&ze(this,Ee,new ri(n,o)),t.passes.findIndex(a=>a===J(this,Ee))===-1&&t.addPass(J(this,Ee)),J(this,Ce)===null&&ze(this,Ce,new st(ni)),t.passes.findIndex(a=>a===J(this,Ce))===-1&&t.addPass(J(this,Ce)),J(this,ue)===null&&(ze(this,ue,new Re({x:s.clientWidth,y:s.clientHeight},this.ssThreeObject.threeScene,this.ssThreeObject.threeCamera)),J(this,ue).edgeStrength=5,J(this,ue).edgeGlow=2,J(this,ue).edgeThickness=1,J(this,ue).pulsePeriod=3,J(this,ue).usePatternTexture=!1),J(this,ue).visibleEdgeColor=new A.Color(i),J(this,ue).hiddenEdgeColor=new A.Color(i),t.passes.findIndex(a=>a===J(this,ue))===-1&&t.addPass(J(this,ue)),J(this,ue).selectedObjects=e});ae(this,"removeOutline",()=>{const e=this.getEffectComposer();e.removePass(J(this,ue)),e.removePass(J(this,Ee)),e.removePass(J(this,Ce)),E.SSDispose.dispose(J(this,ue)),E.SSDispose.dispose(J(this,Ce)),E.SSDispose.dispose(J(this,Ee))});ae(this,"addBloom",()=>{const e=this.getEffectComposer();J(this,Pe)===null&&ze(this,Pe,new je(new A.Vector2(this.ssThreeObject.threeContainer.offsetWidth,this.ssThreeObject.threeContainer.offsetHeight))),e.passes.findIndex(i=>i===J(this,Pe))===-1&&this.effectComposer.addPass(J(this,Pe))});ae(this,"removeBloom",()=>{var e,i;(i=(e=this.effectComposer)==null?void 0:e.removePass)==null||i.call(e,J(this,Pe)),E.SSDispose.dispose(J(this,Pe))});ae(this,"addMaskBoxByObject3Ds",(e,i)=>{const t=new A.MeshStandardMaterial({name:"tempmask",transparent:!0,opacity:.3,color:"#00ffff",depthWrite:!1,userData:{temp_isMask:!0},...i});e.forEach(s=>{var n;if(s.isObject3D){if((n=s.userData)!=null&&n.tempMask){s.userData.tempMask.visible=!0,s.userData.tempMask.position.copy(s.position);return}const o=s.clone();o.name=`${s.name}_tempmask`,o.traverse(a=>{a.type==="Mesh"&&(a.material=t)}),s.parent.add(o),s.userData.tempMask=o}})});ae(this,"removeMaskBox",(e=[])=>{e.forEach(i=>{var t,s,n;i.isObject3D&&(s=(t=i.userData)==null?void 0:t.tempMask)!=null&&s.isObject3D&&(E.SSDispose.dispose((n=i.userData)==null?void 0:n.tempMask),i.userData.tempMask.removeFromParent(),i.userData.tempMask=null)})});ae(this,"getEffectComposer",()=>{if(this.effectComposer instanceof Mt)return this.effectComposer;const{threeRenderer:e,threeContainer:i}=this.ssThreeObject,t=new Mt(e),s=i;return t.setSize(s.clientWidth,s.clientHeight),this.effectComposer=t,this.openRender(),t});ae(this,"openRender",()=>{this.ssThreeObject.cancelRender(),E.SSThreeLoop.add(()=>{this.effectComposer.passes.length>0&&this.effectComposer.render()},"postProcess update")});ae(this,"closeRender",()=>{this.ssThreeObject.render(),E.SSThreeLoop.removeId("postProcess update")});this.ssThreeObject=e}moduleMount(){}getModuleConfig(){return{edgeStrength:5,edgeGlow:2,edgeThickness:1,pulsePeriod:3}}moduleGuiChange(e){console.log(" gui params ",e)}}ue=new WeakMap,Ee=new WeakMap,Ce=new WeakMap,Pe=new WeakMap;const li=200*1024*1024,hi="ss-threejsdb",it=1,Ge="【ss-threejs】";class ci{constructor(e){this.targetDataBase=null,this._dbOptions=null,this._cachedSize=null,this.DATABASE_TABLES=[{name:"model",dbVersion:it,columns:[{name:"model_name",primarykey:!0,unique:!1,autoIncrement:!1,type:"add"},{name:"model_type",type:"add"},{name:"model_path",type:"add"},{name:"size",type:"add"},{name:"create_time",type:"add"},{name:"update_time",type:"add"}]},{name:"modelfile",dbVersion:it,columns:[{name:"model_name",primarykey:!0,unique:!1,autoIncrement:!1,type:"add"},{name:"data",type:"add"}]}],this.createDataTables=(i,t)=>{for(let s=0;s<t.length;s++){const n=t[s],{name:o,columns:a=[],dbVersion:h}=n;if(h===i.version)if(i.objectStoreNames.contains(o)){const c=i.transaction(o).objectStore(o);a.forEach(u=>{u.type==="add"?c.createIndex(u.name,u.name,{unique:u.unique}):u.type==="del"&&c.deleteIndex(u.name)})}else{const c=a.filter(f=>f.primarykey===!0).map(f=>f.name)||[],u=i.createObjectStore(o,{keyPath:c[0]});a.forEach(f=>{f.type==="add"&&u.createIndex(f.name,f.name,{unique:f.unique})})}}},this.addDbObserver=i=>{i.onabort=t=>{console.log(`${Ge}db abort`,t)},i.onclose=t=>{console.log(`${Ge}db close`,t)},i.onerror=t=>{console.log(`${Ge}db error`,t)},i.onversionchange=t=>{console.log(`${Ge}db version change`,t)}},this.insertModel=(i,t)=>this.open().then(s=>this.autoLRU(s,t.byteLength).then(()=>new Promise((n,o)=>{const a=this.DATABASE_TABLES[0].name,h=this.DATABASE_TABLES[1].name,c=s.transaction([a,h],"readwrite"),u=c.objectStore(a),f=c.objectStore(h);u.add({model_name:i,model_type:"",model_path:i,size:t.byteLength,create_time:new Date().valueOf(),update_time:new Date().valueOf()}),f.add({model_name:i,data:t}),c.oncomplete=()=>{this.updateTotalSize(t.byteLength),n(!0)},c.onerror=R=>{o(R)},c.onabort=R=>{o(R)}}))),this.getModel=i=>{const t=this.DATABASE_TABLES[1].name;return this.get(i,t).then(s=>{if(s){const n=this.DATABASE_TABLES[0].name;this.get(i,n).then(o=>o?(o.update_time=new Date().valueOf(),this.update(o,n)):null)}return s})},this.deleteModels=(i,t=[])=>t.length===0?Promise.resolve():new Promise((s,n)=>{const o=this.DATABASE_TABLES[0].name,a=this.DATABASE_TABLES[1].name,h=i.transaction([o,a],"readwrite"),c=h.objectStore(o),u=h.objectStore(a);t.forEach(f=>{c.delete(f),u.delete(f)}),h.oncomplete=()=>{s(!0)},h.onerror=f=>{n(f)},h.onabort=f=>{n(f)}}),this.get=(i,t)=>new Promise((s,n)=>{this.open().then(o=>{const c=o.transaction(t,"readwrite").objectStore(t).get(i);c.onsuccess=()=>{const u=c.result;s(u)},c.onerror=u=>{n(u)}})}),this.update=(i,t)=>new Promise((s,n)=>{this.open().then(o=>{const c=o.transaction(t,"readwrite").objectStore(t).put(i);c.onsuccess=()=>{s(c.result)},c.onerror=u=>{n(u)}})}),this.delete=(i,t)=>new Promise((s,n)=>{this.open().then(o=>{if(o instanceof IDBDatabase){const c=o.transaction(t,"readwrite").objectStore(t).delete(i);c.onsuccess=()=>{s(c.result)},c.onerror=u=>{n(u)}}})}),this.autoLRU=(i,t=0)=>this.getTotalSize(i).then(s=>{let n=this._dbOptions.maxStorageSize-(s+t);if(!(n>0))return n=Math.abs(n),new Promise((o,a)=>{const h=this.DATABASE_TABLES[0].name,f=i.transaction([h],"readonly").objectStore(h).getAll();f.onsuccess=()=>{const p=(f.result||[]).sort((x,P)=>x.update_time-P.update_time),v=[];let m=0,d=0;for(;n>m&&!(p.length<=d);){const x=p==null?void 0:p[d];m+=x.size,v.push(x.model_name),d+=1}n>m&&console.error(`${Ge}初始化缓存大小配置，请将CacheSize配置调大到${t/1024/1024}M以上`),o({modelNames:v,reduceSize:m})},f.onerror=R=>{a(R)}}).then(o=>this.deleteModels(i,o.modelNames).then(()=>{this.updateTotalSize(o.reduceSize*-1)}))}),this.getTotalSize=i=>this._cachedSize!=null?Promise.resolve(this._cachedSize):new Promise((t,s)=>{const n=this.DATABASE_TABLES[0].name,h=i.transaction(n,"readonly").objectStore(n).getAll();h.onsuccess=()=>{const u=h.result.reduce((f,R)=>f+R.size,0);this._cachedSize=u,t(u)},h.onerror=c=>{s(c)}}),this.updateTotalSize=i=>{this._cachedSize!==null&&(this._cachedSize+=i)},e?this._dbOptions=e:this._dbOptions={maxStorageSize:li}}destory(){var e;(e=this.targetDataBase)==null||e.close(),this.targetDataBase=null}open(){return this.targetDataBase?Promise.resolve(this.targetDataBase):new Promise((e,i)=>{const t=window.indexedDB.open(hi,it);t.onsuccess=()=>{const s=t.result;this.targetDataBase=s,e(this.targetDataBase)},t.onerror=s=>{this.targetDataBase=null,i(s)},t.onupgradeneeded=s=>{const n=t.result;this.createDataTables(n,this.DATABASE_TABLES),this.targetDataBase=n,e(n)},t.onblocked=s=>{i(s)}})}}class di{constructor(e){this.threeLoadingManager=null,this.db=null,this.messageQueue=null,this._progressBgElement=null,this._progressTextElement=null,this._progressElement=null,this.addProgressView=i=>{if(document.getElementById("threeloadingprogress"))return;const t=document.createElement("div");t.id="threeloadingprogress",t.style.height="20px",t.style.borderRadius="10px",t.style.border="1px solid #00E8ff",t.style.padding="1px",t.style.width="15%",t.style.position="absolute",t.style.bottom="10%",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.transition="opacity 1s linear",t.style.opacity="0",i.appendChild(t),this._progressBgElement=t;const s=document.createElement("div");s.style.backgroundColor="#2fa1d6",s.style.maxWidth="100%",s.style.height="100%",s.style.borderRadius="9px",t.appendChild(s),this._progressElement=s;const n=document.createElement("div");n.innerText="模型渲染中...",n.style.position="absolute",n.style.bottom="100%",n.style.color="#2fa1d6",n.style.width="100%",n.style.height="30px",n.style.lineHeight="30px",n.style.textAlign="center",n.style.fontSize="16px",t.appendChild(n),this._progressTextElement=n,this.threeLoadingManager.onStart=(o,a,h)=>{t.style.opacity="1",n.innerText="模型渲染中..."},this.threeLoadingManager.onLoad=()=>{t.style.opacity="0"},this.threeLoadingManager.onProgress=(o,a,h)=>{s.style.width=`${a/h*100}%`},this.threeLoadingManager.onError=o=>{t.style.opacity="0"}},this.removeProgressView=()=>{this._progressBgElement&&this._progressBgElement.remove()},this.downloadUrl=(i,t)=>fetch(i,{method:"GET",headers:{responseType:"arraybuffer"}}).then(s=>{if(!t)try{return s.arrayBuffer()}catch{return s.blob()}const n=s.body.getReader(),o=+s.headers.get("Content-Length");let a=0,h=0;const c=[],u=f=>{if(console.log(" down load下载文件处理 ",f.done,h),f.done){const R=new Uint8Array(a);let p=0;return c.forEach(v=>{R.set(v,p),p+=v.length}),R.buffer}return c.push(f.value),a+=f.value.length,o?h=a/o:(h+=.01,h=Math.min(h,.99)),t==null||t(h,c),n.read().then(u)};return n.read().then(u)}),this.getModelFilePathByUrl=i=>i.startsWith("data:")||i.startsWith("blob:")?Promise.resolve(i):this.db.getModel(i).then(t=>t?URL.createObjectURL(new Blob([t==null?void 0:t.data])):i),this.getModelDataByUrl=i=>this.db.getModel(i).then(t=>t?t.data:this.downloadUrl(i,s=>{this._progressBgElement&&(this._progressBgElement.style.opacity="1"),this._progressTextElement&&(this._progressTextElement.innerText="模型下载中..."),this._progressElement&&(this._progressElement.style.width=`${s*100}%`)}).then(s=>(this.db.insertModel(i,s),s))),this.threeLoadingManager=new A.LoadingManager,this.db=new ci,this.messageQueue=new At,this.threeLoadingManager.setURLModifier(i=>i),this.addProgressView(e)}destory(){var e,i;(e=this.db)==null||e.destory(),this.db=null,this.threeLoadingManager=null,this.removeProgressView(),(i=this.messageQueue)==null||i.destory(),this.messageQueue=null}}class ui{constructor(){this.ssThreeObject=null,this.ssModuleCenter=null,this.ssMessageQueue=null,this.ssTransformControl=null,this.ssPostProcessModule=null,this.threeScene=null,this.threeCamera=null,this.threeAmbientLight=null,this.threeRenderer=null,this.threeEvent=null,this.ssLoadingManager=null,this._axisControlHelper=null,this._statsJs=null,this.setup=e=>{let i=null;if(typeof e=="string"?i=document.getElementById(e):e instanceof HTMLElement&&(i=e),!(i instanceof HTMLElement))return null;if(!ct.isWebGLAvailable()){const c=ct.getWebGLErrorMessage();return i.appendChild(c),null}const t=new A.Scene;this.threeScene=t;const s=i.offsetWidth/i.offsetHeight,n=new A.PerspectiveCamera(45,s,.1,2e4);n.position.set(10,10,10),this.threeCamera=n;const o=this._addRender();i.append(o.domElement),this.threeRenderer=o;const a=new A.AmbientLight(new A.Color(16777215),1);t.add(a),this.threeAmbientLight=a;const h=this._addOrbitControl(n,i);return this.threeEvent=new E.SSEvent(i),this.ssLoadingManager=new di(i),E.SSThreeLoop.setup(),this.ssMessageQueue=new At,this.ssThreeObject=new Dt({container:i,scene:t,camera:n,control:h,renderer:o}),this.ssThreeObject.autoWindowResize(),this.ssThreeObject.renderLoop(),this.ssModuleCenter=new Lt(this.ssThreeObject),this.ssPostProcessModule=new ai(this.ssThreeObject),this.ssTransformControl=new ei(this.ssThreeObject),E.SSThreeLoop.add(()=>{this.ssThreeObject.threeOrbitControl&&this.ssThreeObject.threeOrbitControl.update()},"control update"),t},this.addSkyOld=(e=[])=>{const i=new A.PMREMGenerator(this.threeRenderer),t=new A.CubeTextureLoader(this.ssLoadingManager.threeLoadingManager);return new Promise((s,n)=>{t.load(e,o=>{const a=i.fromCubemap(o).texture;this.threeScene.environment=a,this.threeScene.background=a,i.dispose(),s(o)},null,o=>{i.dispose(),n(o)})})},this.addSun=()=>{const e=new A.Vector3,i=new $e;i.name="Sky",i.scale.setScalar(1e4),this.threeScene.add(i);const t=i.material.uniforms;t.turbidity.value=10,t.rayleigh.value=2,t.mieCoefficient.value=.005,t.mieDirectionalG.value=.8;const s={elevation:10,azimuth:76,turbidity:0,rayleigh:.1,mieCoefficient:.005,mieDirectionalG:.8};return(()=>{i.material.uniforms.turbidity.value=s.turbidity,i.material.uniforms.rayleigh.value=s.rayleigh,i.material.uniforms.mieCoefficient.value=s.mieCoefficient,i.material.uniforms.mieDirectionalG.value=s.mieDirectionalG;const o=A.MathUtils.degToRad(90-s.elevation),a=A.MathUtils.degToRad(s.azimuth);e.setFromSphericalCoords(1,o,a),i.material.uniforms.sunPosition.value.copy(e)})(),i},this.addHDR=e=>{const i=new A.PMREMGenerator(this.threeRenderer);if(e.length===1)return new Promise((s,n)=>{new Rt(this.ssLoadingManager.threeLoadingManager).load(e[0],a=>{const h=i.fromEquirectangular(a).texture;this.threeScene.background=h,this.threeScene.environment=h,i.dispose(),s(a)},null,a=>{i.dispose(),n(a)})});const t=new Gt(this.ssLoadingManager.threeLoadingManager);return new Promise((s,n)=>{t.load(e,o=>{const a=i.fromCubemap(o).texture;this.threeScene.environment=a,this.threeScene.background=a,i.dispose(),s(o)},null,o=>{i.dispose(),n(o)})})},this._addRender=()=>{const e=new A.WebGLRenderer({antialias:!0});return e.shadowMap.enabled=!0,e.shadowMap.type=A.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setClearColor("white",0),e.autoClear=!0,e},this.addDymaicDebug=()=>{this._addAxisControl(this.threeScene),this._addStatAnalyse()},this.removeDymaicDebug=()=>{this._removeAxisControl(),this._removeStatAnalyse()},this.loadModelQueue=(e,i,t,s)=>{if(e.length===0){i==null||i([]);return}const n=[];e.forEach(o=>{this.ssMessageQueue.add(()=>{let a=Promise.resolve();switch(o.type){case"obj":a=E.SSLoader.loadObj(o.obj,o.mtl,null,this.ssLoadingManager.threeLoadingManager);break;case"fbx":a=this.loadFbx(o.fbx);break;case"gltf":a=this.loadGltf(o.gltf);break;case"draco":a=this.loadGltfDraco(o.draco);break;case"opt":a=this.loadGltfOptKTX(o.opt);break}a.then(h=>{var c;t==null||t(o,h),h instanceof A.Object3D?h.traverse(u=>{u.receiveShadow=!0,u.castShadow=!0}):h.scene instanceof A.Object3D&&h.scene.traverse(u=>{u.receiveShadow=!0,u.castShadow=!0}),n.push(h),s==null||s(o,h),(c=this.ssMessageQueue)==null||c.remove()}).catch(h=>{var c;console.log("【SSThreejs】模型渲染失败 ",o,h),(c=this.ssMessageQueue)==null||c.remove()})})}),this.ssMessageQueue.add(()=>{i==null||i(n),this.ssMessageQueue.remove()})},this.getModelDirectory=(e="")=>{const i=e.split("/");return i.pop(),`${i.join("/")}/`},this.loadFbx=e=>this.ssLoadingManager.getModelDataByUrl(e).then(i=>E.SSLoader.loadFbxBuffer(i,this.getModelDirectory(e),this.ssLoadingManager.threeLoadingManager)),this.loadGltf=e=>this.ssLoadingManager.getModelDataByUrl(e).then(i=>E.SSLoader.loadGltfBuffer(i,this.getModelDirectory(e),this.ssLoadingManager.threeLoadingManager)),this.loadGltfDraco=e=>this.ssLoadingManager.getModelDataByUrl(e).then(i=>E.SSLoader.loadGltfDracoBuffer(i,this.getModelDirectory(e),this.ssLoadingManager.threeLoadingManager)),this.loadGltfOptKTX=e=>this.ssLoadingManager.getModelDataByUrl(e).then(i=>E.SSLoader.loadGltfOptKTXBuffer(i,this.getModelDirectory(e),this.ssLoadingManager.threeLoadingManager)),this._addOrbitControl=(e,i)=>{const t=new rt(e||this.threeCamera,i||this.ssThreeObject.threeContainer);return t.enableDamping=!0,t.dampingFactor=.25,t.enableZoom=!0,t.autoRotate=!1,t.autoRotateSpeed=2,t.minDistance=2,t.maxDistance=1e3,t.enablePan=!0,t},this._removeOrbitControl=()=>{this.ssThreeObject.threeOrbitControl!==null&&(this.ssThreeObject.threeOrbitControl.dispose(),this.ssThreeObject.threeOrbitControl=null)},this._addAxisControl=(e=this.threeScene)=>{const i=new A.AxesHelper(100);e.add(i),this._axisControlHelper=i},this._removeAxisControl=()=>{this._axisControlHelper!==null&&(this._axisControlHelper.dispose(),this._axisControlHelper=null)},this._addStatAnalyse=(e=this.ssThreeObject.threeContainer)=>{const i=new E.Stats;this._statsJs=i,i.showPanel(0),e.appendChild(i.dom),i.dom.style.position="absolute",i.dom.style.top="unset",i.dom.style.bottom="0px",E.SSThreeLoop.add(()=>{i.update()},"fps render")},this._removeStatAnalyse=()=>{this._statsJs!==null&&(this._statsJs.dom.remove(),this._statsJs.end(),this._statsJs=null,E.SSThreeLoop.removeId("fps render"))},this.getModelsByPoint=(e,i,t)=>this.ssThreeObject.getModelsByPoint(e,i,t)}destroy(e=!0){var i,t,s,n,o;(i=this.ssTransformControl)==null||i.destory(),this.ssTransformControl=null,(t=this.ssThreeObject)==null||t.destory(),(s=this.ssMessageQueue)==null||s.destory(),this.ssMessageQueue=null,(n=this.ssLoadingManager)==null||n.destory(),this.ssLoadingManager=null,e&&E.SSThreeLoop.destory(),(o=this.ssModuleCenter)==null||o.destroy(),this.ssModuleCenter=null,this._removeOrbitControl(),this.threeEvent.destory(),this.threeEvent=null,this.threeScene!==null&&(E.SSDispose.dispose(this.threeScene),this.threeRenderer.info.programs.length!==0?console.log("scene material has not released",this.threeRenderer.info):this.threeRenderer.info.memory.geometries?console.log("scene geometries has not released",this.threeRenderer.info):this.threeRenderer.info.memory.textures&&console.log("scene textures has not released",this.threeRenderer.info)),this.threeRenderer!==null&&(this.threeRenderer.dispose(),this.threeRenderer.forceContextLoss(),this.ssThreeObject.threeContainer.removeChild(this.threeRenderer.domElement))}setEye(e,i,t=!0,s=.5,n){this.ssThreeObject.setEye(e,i,t,s,n)}getEye(){return this.ssThreeObject.getEye()}}const fi={SSLinearGradientMaterial:E.SSLinearGradientMaterial,SSLightScanMaterial:E.SSLightScanMaterial};class Bt extends r.Object3D{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new r.Vector2(.5,.5),this.addEventListener("removed",function(){this.traverse(function(i){i.element instanceof Element&&i.element.parentNode!==null&&i.element.parentNode.removeChild(i.element)})})}copy(e,i){return super.copy(e,i),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const ke=new r.Vector3,_t=new r.Matrix4,Tt=new r.Matrix4,Et=new r.Vector3,Ct=new r.Vector3;class pi{constructor(e={}){const i=this;let t,s,n,o;const a={objects:new WeakMap},h=e.element!==void 0?e.element:document.createElement("div");h.style.overflow="hidden",this.domElement=h,this.getSize=function(){return{width:t,height:s}},this.render=function(p,v){p.matrixWorldAutoUpdate===!0&&p.updateMatrixWorld(),v.parent===null&&v.matrixWorldAutoUpdate===!0&&v.updateMatrixWorld(),_t.copy(v.matrixWorldInverse),Tt.multiplyMatrices(v.projectionMatrix,_t),c(p,p,v),R(p)},this.setSize=function(p,v){t=p,s=v,n=t/2,o=s/2,h.style.width=p+"px",h.style.height=v+"px"};function c(p,v,m){if(p.isCSS2DObject){ke.setFromMatrixPosition(p.matrixWorld),ke.applyMatrix4(Tt);const d=p.visible===!0&&ke.z>=-1&&ke.z<=1&&p.layers.test(m.layers)===!0;if(p.element.style.display=d===!0?"":"none",d===!0){p.onBeforeRender(i,v,m);const P=p.element;P.style.transform="translate("+-100*p.center.x+"%,"+-100*p.center.y+"%)translate("+(ke.x*n+n)+"px,"+(-ke.y*o+o)+"px)",P.parentNode!==h&&h.appendChild(P),p.onAfterRender(i,v,m)}const x={distanceToCameraSquared:u(m,p)};a.objects.set(p,x)}for(let d=0,x=p.children.length;d<x;d++)c(p.children[d],v,m)}function u(p,v){return Et.setFromMatrixPosition(p.matrixWorld),Ct.setFromMatrixPosition(v.matrixWorld),Et.distanceToSquared(Ct)}function f(p){const v=[];return p.traverse(function(m){m.isCSS2DObject&&v.push(m)}),v}function R(p){const v=f(p).sort(function(d,x){if(d.renderOrder!==x.renderOrder)return x.renderOrder-d.renderOrder;const P=a.objects.get(d).distanceToCameraSquared,g=a.objects.get(x).distanceToCameraSquared;return P-g}),m=v.length;for(let d=0,x=v.length;d<x;d++)v[d].element.style.zIndex=m-d}}}const Pt=new r.Vector3,mi=new r.Quaternion,Ot=new r.Vector3;class gi extends r.Object3D{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(i){i.element instanceof Element&&i.element.parentNode!==null&&i.element.parentNode.removeChild(i.element)})})}copy(e,i){return super.copy(e,i),this.element=e.element.cloneNode(!0),this}}const xe=new r.Matrix4,yi=new r.Matrix4;class vi{constructor(e={}){const i=this;let t,s,n,o;const a={camera:{fov:0,style:""},objects:new WeakMap},h=e.element!==void 0?e.element:document.createElement("div");h.style.overflow="hidden",this.domElement=h;const c=document.createElement("div");c.style.transformOrigin="0 0",c.style.pointerEvents="none",h.appendChild(c);const u=document.createElement("div");u.style.transformStyle="preserve-3d",c.appendChild(u),this.getSize=function(){return{width:t,height:s}},this.render=function(m,d){const x=d.projectionMatrix.elements[5]*o;a.camera.fov!==x&&(c.style.perspective=d.isPerspectiveCamera?x+"px":"",a.camera.fov=x),d.view&&d.view.enabled?(c.style.transform=`translate( ${-d.view.offsetX*(t/d.view.width)}px, ${-d.view.offsetY*(s/d.view.height)}px )`,c.style.transform+=`scale( ${d.view.fullWidth/d.view.width}, ${d.view.fullHeight/d.view.height} )`):c.style.transform="",m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),d.parent===null&&d.matrixWorldAutoUpdate===!0&&d.updateMatrixWorld();let P,g;d.isOrthographicCamera&&(P=-(d.right+d.left)/2,g=(d.top+d.bottom)/2);const w=d.view&&d.view.enabled?d.view.height/d.view.fullHeight:1,B=(d.isOrthographicCamera?`scale( ${w} )scale(`+x+")translate("+f(P)+"px,"+f(g)+"px)"+R(d.matrixWorldInverse):`scale( ${w} )translateZ(`+x+"px)"+R(d.matrixWorldInverse))+"translate("+n+"px,"+o+"px)";a.camera.style!==B&&(u.style.transform=B,a.camera.style=B),v(m,m,d)},this.setSize=function(m,d){t=m,s=d,n=t/2,o=s/2,h.style.width=m+"px",h.style.height=d+"px",c.style.width=m+"px",c.style.height=d+"px",u.style.width=m+"px",u.style.height=d+"px"};function f(m){return Math.abs(m)<1e-10?0:m}function R(m){const d=m.elements;return"matrix3d("+f(d[0])+","+f(-d[1])+","+f(d[2])+","+f(d[3])+","+f(d[4])+","+f(-d[5])+","+f(d[6])+","+f(d[7])+","+f(d[8])+","+f(-d[9])+","+f(d[10])+","+f(d[11])+","+f(d[12])+","+f(-d[13])+","+f(d[14])+","+f(d[15])+")"}function p(m){const d=m.elements;return"translate(-50%,-50%)"+("matrix3d("+f(d[0])+","+f(d[1])+","+f(d[2])+","+f(d[3])+","+f(-d[4])+","+f(-d[5])+","+f(-d[6])+","+f(-d[7])+","+f(d[8])+","+f(d[9])+","+f(d[10])+","+f(d[11])+","+f(d[12])+","+f(d[13])+","+f(d[14])+","+f(d[15])+")")}function v(m,d,x,P){if(m.isCSS3DObject){const g=m.visible===!0&&m.layers.test(x.layers)===!0;if(m.element.style.display=g===!0?"":"none",g===!0){m.onBeforeRender(i,d,x);let w;m.isCSS3DSprite?(xe.copy(x.matrixWorldInverse),xe.transpose(),m.rotation2D!==0&&xe.multiply(yi.makeRotationZ(m.rotation2D)),m.matrixWorld.decompose(Pt,mi,Ot),xe.setPosition(Pt),xe.scale(Ot),xe.elements[3]=0,xe.elements[7]=0,xe.elements[11]=0,xe.elements[15]=1,w=p(xe)):w=p(m.matrixWorld);const S=m.element,B=a.objects.get(m);if(B===void 0||B.style!==w){S.style.transform=w;const Y={style:w};a.objects.set(m,Y)}S.parentNode!==u&&u.appendChild(S),m.onAfterRender(i,d,x)}}for(let g=0,w=m.children.length;g<w;g++)v(m.children[g],d,x)}}}class bi{constructor(){this.id=0,this.object=null,this.z=0,this.renderOrder=0}}class It{constructor(){this.id=0,this.v1=new Fe,this.v2=new Fe,this.v3=new Fe,this.normalModel=new r.Vector3,this.vertexNormalsModel=[new r.Vector3,new r.Vector3,new r.Vector3],this.vertexNormalsLength=0,this.color=new r.Color,this.material=null,this.uvs=[new r.Vector2,new r.Vector2,new r.Vector2],this.z=0,this.renderOrder=0}}class Fe{constructor(){this.position=new r.Vector3,this.positionWorld=new r.Vector3,this.positionScreen=new r.Vector4,this.visible=!0}copy(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)}}class zt{constructor(){this.id=0,this.v1=new Fe,this.v2=new Fe,this.vertexColors=[new r.Color,new r.Color],this.material=null,this.z=0,this.renderOrder=0}}class kt{constructor(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new r.Vector2,this.material=null,this.renderOrder=0}}class Si{constructor(){let e,i,t=0,s,n,o=0,a,h,c=0,u,f,R=0,p,v,m=0,d;const x={objects:[],lights:[],elements:[]},P=new r.Vector3,g=new r.Vector4,w=new r.Box3(new r.Vector3(-1,-1,-1),new r.Vector3(1,1,1)),S=new r.Box3,B=new Array(3),Y=new r.Matrix4,j=new r.Matrix4,D=new r.Matrix4,G=new r.Frustum,V=[],oe=[],fe=[],ie=[],K=[];function pe(){const b=[],U=[],M=[];let C=null;const F=new r.Matrix3;function I(_){C=_,F.getNormalMatrix(C.matrixWorld),b.length=0,U.length=0,M.length=0}function T(_){const N=_.position,Q=_.positionWorld,q=_.positionScreen;Q.copy(N).applyMatrix4(d),q.copy(Q).applyMatrix4(j);const me=1/q.w;q.x*=me,q.y*=me,q.z*=me,_.visible=q.x>=-1&&q.x<=1&&q.y>=-1&&q.y<=1&&q.z>=-1&&q.z<=1}function L(_,N,Q){s=be(),s.position.set(_,N,Q),T(s)}function H(_,N,Q){b.push(_,N,Q)}function ee(_,N,Q){U.push(_,N,Q)}function le(_,N){M.push(_,N)}function z(_,N,Q){return _.visible===!0||N.visible===!0||Q.visible===!0?!0:(B[0]=_.positionScreen,B[1]=N.positionScreen,B[2]=Q.positionScreen,w.intersectsBox(S.setFromPoints(B)))}function Z(_,N,Q){return(Q.positionScreen.x-_.positionScreen.x)*(N.positionScreen.y-_.positionScreen.y)-(Q.positionScreen.y-_.positionScreen.y)*(N.positionScreen.x-_.positionScreen.x)<0}function de(_,N){const Q=oe[_],q=oe[N];Q.positionScreen.copy(Q.position).applyMatrix4(D),q.positionScreen.copy(q.position).applyMatrix4(D),Le(Q.positionScreen,q.positionScreen)===!0&&(Q.positionScreen.multiplyScalar(1/Q.positionScreen.w),q.positionScreen.multiplyScalar(1/q.positionScreen.w),u=we(),u.id=C.id,u.v1.copy(Q),u.v2.copy(q),u.z=Math.max(Q.positionScreen.z,q.positionScreen.z),u.renderOrder=C.renderOrder,u.material=C.material,C.material.vertexColors&&(u.vertexColors[0].fromArray(U,_*3),u.vertexColors[1].fromArray(U,N*3)),x.elements.push(u))}function k(_,N,Q,q){const me=oe[_],l=oe[N],O=oe[Q];if(z(me,l,O)!==!1&&(q.side===r.DoubleSide||Z(me,l,O)===!0)){a=De(),a.id=C.id,a.v1.copy(me),a.v2.copy(l),a.v3.copy(O),a.z=(me.positionScreen.z+l.positionScreen.z+O.positionScreen.z)/3,a.renderOrder=C.renderOrder,P.subVectors(O.position,l.position),g.subVectors(me.position,l.position),P.cross(g),a.normalModel.copy(P),a.normalModel.applyMatrix3(F).normalize();for(let $=0;$<3;$++){const he=a.vertexNormalsModel[$];he.fromArray(b,arguments[$]*3),he.applyMatrix3(F).normalize(),a.uvs[$].fromArray(M,arguments[$]*2)}a.vertexNormalsLength=3,a.material=q,q.vertexColors&&a.color.fromArray(U,_*3),x.elements.push(a)}}return{setObject:I,projectVertex:T,checkTriangleVisibility:z,checkBackfaceCulling:Z,pushVertex:L,pushNormal:H,pushColor:ee,pushUv:le,pushLine:de,pushTriangle:k}}const W=new pe;function X(b){if(b.visible===!1)return;if(b.isLight)x.lights.push(b);else if(b.isMesh||b.isLine||b.isPoints){if(b.material.visible===!1||b.frustumCulled===!0&&G.intersectsObject(b)===!1)return;re(b)}else if(b.isSprite){if(b.material.visible===!1||b.frustumCulled===!0&&G.intersectsSprite(b)===!1)return;re(b)}const U=b.children;for(let M=0,C=U.length;M<C;M++)X(U[M])}function re(b){e=ve(),e.id=b.id,e.object=b,P.setFromMatrixPosition(b.matrixWorld),P.applyMatrix4(j),e.z=P.z,e.renderOrder=b.renderOrder,x.objects.push(e)}this.projectScene=function(b,U,M,C){h=0,f=0,v=0,x.elements.length=0,b.matrixWorldAutoUpdate===!0&&b.updateMatrixWorld(),U.parent===null&&U.matrixWorldAutoUpdate===!0&&U.updateMatrixWorld(),Y.copy(U.matrixWorldInverse),j.multiplyMatrices(U.projectionMatrix,Y),G.setFromProjectionMatrix(j),i=0,x.objects.length=0,x.lights.length=0,X(b),M===!0&&x.objects.sort(Me);const F=x.objects;for(let I=0,T=F.length;I<T;I++){const L=F[I].object,H=L.geometry;if(W.setObject(L),d=L.matrixWorld,n=0,L.isMesh){let ee=L.material;const le=Array.isArray(ee),z=H.attributes,Z=H.groups;if(z.position===void 0)continue;const de=z.position.array;for(let k=0,_=de.length;k<_;k+=3){let N=de[k],Q=de[k+1],q=de[k+2];const me=H.morphAttributes.position;if(me!==void 0){const l=H.morphTargetsRelative,O=L.morphTargetInfluences;for(let $=0,he=me.length;$<he;$++){const ce=O[$];if(ce===0)continue;const ye=me[$];l?(N+=ye.getX(k/3)*ce,Q+=ye.getY(k/3)*ce,q+=ye.getZ(k/3)*ce):(N+=(ye.getX(k/3)-de[k])*ce,Q+=(ye.getY(k/3)-de[k+1])*ce,q+=(ye.getZ(k/3)-de[k+2])*ce)}}W.pushVertex(N,Q,q)}if(z.normal!==void 0){const k=z.normal.array;for(let _=0,N=k.length;_<N;_+=3)W.pushNormal(k[_],k[_+1],k[_+2])}if(z.color!==void 0){const k=z.color.array;for(let _=0,N=k.length;_<N;_+=3)W.pushColor(k[_],k[_+1],k[_+2])}if(z.uv!==void 0){const k=z.uv.array;for(let _=0,N=k.length;_<N;_+=2)W.pushUv(k[_],k[_+1])}if(H.index!==null){const k=H.index.array;if(Z.length>0)for(let _=0;_<Z.length;_++){const N=Z[_];if(ee=le===!0?L.material[N.materialIndex]:L.material,ee!==void 0)for(let Q=N.start,q=N.start+N.count;Q<q;Q+=3)W.pushTriangle(k[Q],k[Q+1],k[Q+2],ee)}else for(let _=0,N=k.length;_<N;_+=3)W.pushTriangle(k[_],k[_+1],k[_+2],ee)}else if(Z.length>0)for(let k=0;k<Z.length;k++){const _=Z[k];if(ee=le===!0?L.material[_.materialIndex]:L.material,ee!==void 0)for(let N=_.start,Q=_.start+_.count;N<Q;N+=3)W.pushTriangle(N,N+1,N+2,ee)}else for(let k=0,_=de.length/3;k<_;k+=3)W.pushTriangle(k,k+1,k+2,ee)}else if(L.isLine){D.multiplyMatrices(j,d);const ee=H.attributes;if(ee.position!==void 0){const le=ee.position.array;for(let z=0,Z=le.length;z<Z;z+=3)W.pushVertex(le[z],le[z+1],le[z+2]);if(ee.color!==void 0){const z=ee.color.array;for(let Z=0,de=z.length;Z<de;Z+=3)W.pushColor(z[Z],z[Z+1],z[Z+2])}if(H.index!==null){const z=H.index.array;for(let Z=0,de=z.length;Z<de;Z+=2)W.pushLine(z[Z],z[Z+1])}else{const z=L.isLineSegments?2:1;for(let Z=0,de=le.length/3-1;Z<de;Z+=z)W.pushLine(Z,Z+1)}}}else if(L.isPoints){D.multiplyMatrices(j,d);const ee=H.attributes;if(ee.position!==void 0){const le=ee.position.array;for(let z=0,Z=le.length;z<Z;z+=3)g.set(le[z],le[z+1],le[z+2],1),g.applyMatrix4(D),se(g,L,U)}}else L.isSprite&&(L.modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,L.matrixWorld),g.set(d.elements[12],d.elements[13],d.elements[14],1),g.applyMatrix4(j),se(g,L,U))}return C===!0&&x.elements.sort(Me),x};function se(b,U,M){const C=1/b.w;b.z*=C,b.z>=-1&&b.z<=1&&(p=Ie(),p.id=U.id,p.x=b.x*C,p.y=b.y*C,p.z=b.z,p.renderOrder=U.renderOrder,p.object=U,p.rotation=U.rotation,p.scale.x=U.scale.x*Math.abs(p.x-(b.x+M.projectionMatrix.elements[0])/(b.w+M.projectionMatrix.elements[12])),p.scale.y=U.scale.y*Math.abs(p.y-(b.y+M.projectionMatrix.elements[5])/(b.w+M.projectionMatrix.elements[13])),p.material=U.material,x.elements.push(p))}function ve(){if(i===t){const b=new bi;return V.push(b),t++,i++,b}return V[i++]}function be(){if(n===o){const b=new Fe;return oe.push(b),o++,n++,b}return oe[n++]}function De(){if(h===c){const b=new It;return fe.push(b),c++,h++,b}return fe[h++]}function we(){if(f===R){const b=new zt;return ie.push(b),R++,f++,b}return ie[f++]}function Ie(){if(v===m){const b=new kt;return K.push(b),m++,v++,b}return K[v++]}function Me(b,U){return b.renderOrder!==U.renderOrder?b.renderOrder-U.renderOrder:b.z!==U.z?U.z-b.z:b.id!==U.id?b.id-U.id:0}function Le(b,U){let M=0,C=1;const F=b.z+b.w,I=U.z+U.w,T=-b.z+b.w,L=-U.z+U.w;return F>=0&&I>=0&&T>=0&&L>=0?!0:F<0&&I<0||T<0&&L<0?!1:(F<0?M=Math.max(M,F/(F-I)):I<0&&(C=Math.min(C,F/(F-I))),T<0?M=Math.max(M,T/(T-L)):L<0&&(C=Math.min(C,T/(T-L))),C<M?!1:(b.lerp(U,M),U.lerp(b,1-C),!0))}}}class xi{constructor(){let e,i,t,s,n,o,a,h,c,u,f,R=0,p=null,v=1,m,d;const x=this,P=new r.Box2,g=new r.Box2,w=new r.Color,S=new r.Color,B=new r.Color,Y=new r.Color,j=new r.Color,D=new r.Color,G=new r.Vector3,V=new r.Vector3,oe=new r.Vector3,fe=new r.Matrix3,ie=new r.Matrix4,K=new r.Matrix4,pe=[],W=new Si,X=document.createElementNS("http://www.w3.org/2000/svg","svg");this.domElement=X,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.info={render:{vertices:0,faces:0}},this.setQuality=function(M){switch(M){case"high":v=1;break;case"low":v=0;break}},this.setClearColor=function(M){D.set(M)},this.setPixelRatio=function(){},this.setSize=function(M,C){s=M,n=C,o=s/2,a=n/2,X.setAttribute("viewBox",-o+" "+-a+" "+s+" "+n),X.setAttribute("width",s),X.setAttribute("height",n),P.min.set(-o,-a),P.max.set(o,a)},this.getSize=function(){return{width:s,height:n}},this.setPrecision=function(M){p=M};function re(){for(R=0;X.childNodes.length>0;)X.removeChild(X.childNodes[0])}function se(M){return p!==null?M.toFixed(p):M}this.clear=function(){re(),X.style.backgroundColor=D.getStyle()},this.render=function(M,C){if(!(C instanceof r.Camera)){console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.");return}const F=M.background;F&&F.isColor?(re(),X.style.backgroundColor=F.getStyle()):this.autoClear===!0&&this.clear(),x.info.render.vertices=0,x.info.render.faces=0,ie.copy(C.matrixWorldInverse),K.multiplyMatrices(C.projectionMatrix,ie),e=W.projectScene(M,C,this.sortObjects,this.sortElements),i=e.elements,t=e.lights,fe.getNormalMatrix(C.matrixWorldInverse),ve(t),m="",d="";for(let I=0,T=i.length;I<T;I++){const L=i[I],H=L.material;if(!(H===void 0||H.opacity===0)){if(g.makeEmpty(),L instanceof kt)h=L,h.x*=o,h.y*=-a,De(h,L,H);else if(L instanceof zt)h=L.v1,c=L.v2,h.positionScreen.x*=o,h.positionScreen.y*=-a,c.positionScreen.x*=o,c.positionScreen.y*=-a,g.setFromPoints([h.positionScreen,c.positionScreen]),P.intersectsBox(g)===!0&&we(h,c,H);else if(L instanceof It){if(h=L.v1,c=L.v2,u=L.v3,h.positionScreen.z<-1||h.positionScreen.z>1||c.positionScreen.z<-1||c.positionScreen.z>1||u.positionScreen.z<-1||u.positionScreen.z>1)continue;h.positionScreen.x*=o,h.positionScreen.y*=-a,c.positionScreen.x*=o,c.positionScreen.y*=-a,u.positionScreen.x*=o,u.positionScreen.y*=-a,this.overdraw>0&&(Me(h.positionScreen,c.positionScreen,this.overdraw),Me(c.positionScreen,u.positionScreen,this.overdraw),Me(u.positionScreen,h.positionScreen,this.overdraw)),g.setFromPoints([h.positionScreen,c.positionScreen,u.positionScreen]),P.intersectsBox(g)===!0&&Ie(h,c,u,L,H)}}}b(),M.traverseVisible(function(I){if(I.isSVGObject){if(G.setFromMatrixPosition(I.matrixWorld),G.applyMatrix4(K),G.z<-1||G.z>1)return;const T=G.x*o,L=-G.y*a,H=I.node;H.setAttribute("transform","translate("+T+","+L+")"),X.appendChild(H)}})};function ve(M){B.setRGB(0,0,0),Y.setRGB(0,0,0),j.setRGB(0,0,0);for(let C=0,F=M.length;C<F;C++){const I=M[C],T=I.color;I.isAmbientLight?(B.r+=T.r,B.g+=T.g,B.b+=T.b):I.isDirectionalLight?(Y.r+=T.r,Y.g+=T.g,Y.b+=T.b):I.isPointLight&&(j.r+=T.r,j.g+=T.g,j.b+=T.b)}}function be(M,C,F,I){for(let T=0,L=M.length;T<L;T++){const H=M[T],ee=H.color;if(H.isDirectionalLight){const le=G.setFromMatrixPosition(H.matrixWorld).normalize();let z=F.dot(le);if(z<=0)continue;z*=H.intensity,I.r+=ee.r*z,I.g+=ee.g*z,I.b+=ee.b*z}else if(H.isPointLight){const le=G.setFromMatrixPosition(H.matrixWorld);let z=F.dot(G.subVectors(le,C).normalize());if(z<=0||(z*=H.distance==0?1:1-Math.min(C.distanceTo(le)/H.distance,1),z==0))continue;z*=H.intensity,I.r+=ee.r*z,I.g+=ee.g*z,I.b+=ee.b*z}}}function De(M,C,F){let I=C.scale.x*o,T=C.scale.y*a;F.isPointsMaterial&&(I*=F.size,T*=F.size);const L="M"+se(M.x-I*.5)+","+se(M.y-T*.5)+"h"+se(I)+"v"+se(T)+"h"+se(-I)+"z";let H="";(F.isSpriteMaterial||F.isPointsMaterial)&&(H="fill:"+F.color.getStyle()+";fill-opacity:"+F.opacity),Le(H,L)}function we(M,C,F){const I="M"+se(M.positionScreen.x)+","+se(M.positionScreen.y)+"L"+se(C.positionScreen.x)+","+se(C.positionScreen.y);if(F.isLineBasicMaterial){let T="fill:none;stroke:"+F.color.getStyle()+";stroke-opacity:"+F.opacity+";stroke-width:"+F.linewidth+";stroke-linecap:"+F.linecap;F.isLineDashedMaterial&&(T=T+";stroke-dasharray:"+F.dashSize+","+F.gapSize),Le(T,I)}}function Ie(M,C,F,I,T){x.info.render.vertices+=3,x.info.render.faces++;const L="M"+se(M.positionScreen.x)+","+se(M.positionScreen.y)+"L"+se(C.positionScreen.x)+","+se(C.positionScreen.y)+"L"+se(F.positionScreen.x)+","+se(F.positionScreen.y)+"z";let H="";T.isMeshBasicMaterial?(w.copy(T.color),T.vertexColors&&w.multiply(I.color)):T.isMeshLambertMaterial||T.isMeshPhongMaterial||T.isMeshStandardMaterial?(S.copy(T.color),T.vertexColors&&S.multiply(I.color),w.copy(B),V.copy(M.positionWorld).add(C.positionWorld).add(F.positionWorld).divideScalar(3),be(t,V,I.normalModel,w),w.multiply(S).add(T.emissive)):T.isMeshNormalMaterial&&(oe.copy(I.normalModel).applyMatrix3(fe).normalize(),w.setRGB(oe.x,oe.y,oe.z).multiplyScalar(.5).addScalar(.5)),T.wireframe?H="fill:none;stroke:"+w.getStyle()+";stroke-opacity:"+T.opacity+";stroke-width:"+T.wireframeLinewidth+";stroke-linecap:"+T.wireframeLinecap+";stroke-linejoin:"+T.wireframeLinejoin:H="fill:"+w.getStyle()+";fill-opacity:"+T.opacity,Le(H,L)}function Me(M,C,F){let I=C.x-M.x,T=C.y-M.y;const L=I*I+T*T;if(L===0)return;const H=F/Math.sqrt(L);I*=H,T*=H,C.x+=I,C.y+=T,M.x-=I,M.y-=T}function Le(M,C){d===M?m+=C:(b(),d=M,m=C)}function b(){m&&(f=U(R++),f.setAttribute("d",m),f.setAttribute("style",d),X.appendChild(f)),m="",d=""}function U(M){return pe[M]==null&&(pe[M]=document.createElementNS("http://www.w3.org/2000/svg","path"),v==0&&pe[M].setAttribute("shape-rendering","crispEdges")),pe[M]}}}class wi{constructor(e){this.css2dRender=null,this.css3dRender=null,this.svgRender=null,this._resizeObserver=null,this._ssThreeObject=null,this.destory=()=>{this._removeResizeOBserver(),E.SSThreeLoop.removeIds(["svgFrameHandle","css2dFrameHandle","css3dFrameHandle"]),this.cancelRender2D(),this.cancelRender3D(),this.cancelRenderSVG(),this._ssThreeObject=null},this.render2D=()=>{const{threeScene:i,threeCamera:t,threeContainer:s}=this._ssThreeObject;this._addResizeObserver(s),!this.css2dRender&&(this.css2dRender=new pi,this.css2dRender.domElement.style.position="absolute",this.css2dRender.domElement.style.top="0px",this.css2dRender.setSize(s.offsetWidth,s.offsetHeight),s.appendChild(this.css2dRender.domElement),E.SSThreeLoop.add(()=>{this.css2dRender.render(i,t)},"css2dFrameHandle"))},this.cancelRender2D=()=>{var i,t;E.SSThreeLoop.removeId("css2dFrameHandle"),(t=(i=this.css2dRender)==null?void 0:i.domElement)==null||t.remove(),this.css2dRender=null},this.render3D=()=>{const{threeScene:i,threeCamera:t,threeContainer:s}=this._ssThreeObject;this._addResizeObserver(s),!this.css3dRender&&(this.css3dRender=new vi,this.css3dRender.domElement.style.position="absolute",this.css3dRender.domElement.style.top="0px",this.css3dRender.setSize(s.offsetWidth,s.offsetHeight),s.appendChild(this.css3dRender.domElement),E.SSThreeLoop.add(()=>{this.css3dRender.render(i,t)},"css3dFrameHandle"))},this.cancelRender3D=()=>{var i,t;E.SSThreeLoop.removeId("css3dFrameHandle"),(t=(i=this.css3dRender)==null?void 0:i.domElement)==null||t.remove(),this.css3dRender=null},this.renderSVG=()=>{const{threeScene:i,threeCamera:t,threeContainer:s}=this._ssThreeObject;this._addResizeObserver(s),!this.svgRender&&(this.svgRender=new xi,this.svgRender.domElement.style.position="absolute",this.svgRender.domElement.style.top="0px",this.svgRender.setSize(s.offsetWidth,s.offsetHeight),s.appendChild(this.svgRender.domElement),E.SSThreeLoop.add(()=>{this.svgRender.render(i,t)},"svgFrameHandle"))},this.cancelRenderSVG=()=>{var i,t;E.SSThreeLoop.removeId("svgFrameHandle"),(t=(i=this.svgRender)==null?void 0:i.domElement)==null||t.remove(),this.svgRender=null},this.drawingLabel=(i,t,s,n)=>{const o=[i,t,s],a=new A.LineBasicMaterial({color:51390,linewidth:10}),h=new A.BufferGeometry().setFromPoints(o),c=new A.Line(h,a),u=document.createElement("div");u.className="label",u.style.fontSize="40px",u.style.marginTop="-42px",u.style.padding="40px 80px",u.style.backgroundColor="#fff",u.style.color="#000000",u.style.border="1px solid #16BFB0",u.textContent=n||"示例";const f=new Bt(u);return f.position.set(s.x,s.y,s.z),{line:c,tagLabel:f}},this.drawLines=(i,t,s=.001)=>{i.length()===0&&(i.x=.001);const n=0,o=n*2.5,a=n*n*50,h=new A.Vector3(0,0,0),c=new A.Ray(h,this._getVCenter(i.clone(),t.clone())),u=c.at(a/c.at(1,new A.Vector3).distanceTo(h),new A.Vector3),f=this._getLenVcetor(i.clone(),u,o),R=this._getLenVcetor(t.clone(),u,o),p=new A.CubicBezierCurve3(i,f,R,t),v=new E.LineGeometry,m=p.getPoints(50),d=[],x=[],P=new A.Color;for(let w=0;w<m.length;w++)P.setHSL(.31666+w*.005,.7,.7),x.push(P.r,P.g,P.b),d.push(m[w].x,m[w].y,m[w].z);v.setPositions(d),v.setColors(x);const g=new E.LineMaterial({linewidth:s,vertexColors:!0,dashed:!1});return{curve:p,lineMesh:new E.Line2(v,g)}},this._getVCenter=(i,t)=>i.add(t).divideScalar(2),this._getLenVcetor=(i,t,s)=>{const n=i.distanceTo(t);return i.lerp(t,s/n)},this._addResizeObserver=(i=document.body)=>{if(this._resizeObserver===null){const t=new window.ResizeObserver(()=>{this.css2dRender&&(E.SSThreeLoop.removeId("css2dFrameHandle"),this.css2dRender.setSize(i.offsetWidth,i.offsetHeight),E.SSThreeLoop.add(()=>{this.css2dRender.render(this._ssThreeObject.threeScene,this._ssThreeObject.threeCamera)},"css2dFrameHandle")),this.css3dRender&&(E.SSThreeLoop.removeId("css3dFrameHandle"),this.css3dRender.setSize(i.offsetWidth,i.offsetHeight),E.SSThreeLoop.add(()=>{this.css3dRender.render(this._ssThreeObject.threeScene,this._ssThreeObject.threeCamera)},"css3dFrameHandle")),this.svgRender&&(E.SSThreeLoop.removeId("svgFrameHandle"),this.svgRender.setSize(i.offsetWidth,i.offsetHeight),E.SSThreeLoop.add(()=>{this.svgRender.render(this._ssThreeObject.threeScene,this._ssThreeObject.threeCamera)},"svgFrameHandle"))});t.observe(i),this._resizeObserver=t}},this._removeResizeOBserver=()=>{this._resizeObserver!==null&&(this._resizeObserver.disconnect(),this._resizeObserver=null)},this._ssThreeObject=e}}class Mi{static pathFromPoints(e,i,t){const s=this.pathGeomery(e,t);return new A.Mesh(s,i)}static pathTubefromPoints(e,i,t){const s=this.pathGeomery(e,t);return new A.Mesh(s,i)}static pathGeomery(e,i){const t=new E.PathPointList;t.set(e,i.cornerRadius,i.cornerSplit,i.up,i.close);const s=new E.PathGeometry({pathPointList:t,options:{width:.1,arrow:!0,progress:1,side:"both"},usage:A.StaticDrawUsage});return s.update(t,{width:.1,arrow:!0,progress:1,side:"both"}),s}static pathTubeGeometry(e,i){const t=new E.PathPointList;t.set(e,i.cornerRadius,i.cornerSplit,i.up,i.close);const s=new E.PathTubeGeometry({pathPointList:t,options:{radius:.1,radialSegments:8,progress:1,startRad:0},usage:A.StaticDrawUsage},!1);return s.update(t,{radius:.1,radialSegments:8,progress:1,startRad:0}),s}}const _i={WallMesh:E.SSWallMesh,WaterMesh:E.SSWaterMesh,PathMesh:Mi};exports.THREE=A;exports.SSDispose=E.SSDispose;exports.SSLoader=E.SSLoader;exports.SSThreeEvent=E.SSEvent;exports.SSThreeLoop=E.SSThreeLoop;exports.SSThreeTool=E.SSThreeTool;exports.CSS2DObject=Bt;exports.CSS3DObject=gi;exports.SSCssRenderer=wi;exports.SSFileSetting=Lt;exports.SSMaterial=fi;exports.SSMesh=_i;exports.SSThreeObject=Dt;exports.default=ui;
